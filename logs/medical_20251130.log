2025-11-30 21:58:41,699 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 21:59:01,553 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 21:59:42,986 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 21:59:48,106 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 21:59:57,964 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 21:59:57,964 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T21:59:57.964376", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 21:59:58,981 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T21:59:58.981153", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 21:59:58,982 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:00:15,655 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:00:15,656 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:00:15.656644", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:00:16,950 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:00:16.950362", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:00:16,951 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:00:38,731 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:00:38,731 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:00:38.731107", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:00:39,390 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:00:39.390902", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:00:39,391 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:01:55,141 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "test_script", "timestamp": "2025-11-30T22:01:55.141296", "data": {"symptom_text": "头痛发烧", "patient_info": {"age": 25, "gender": "male"}}, "data_size": 71}
2025-11-30 22:01:55,141 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:01:55.141296", "prompt_length": 10, "response_length": 9, "tokens_used": 150, "duration_seconds": 2.5, "prompt_preview": "测试提示词内容...", "response_preview": "测试响应内容..."}
2025-11-30 22:01:55,141 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "test_workflow", "status": "started", "timestamp": "2025-11-30T22:01:55.141296", "details": {"step_name": "symptom_analysis", "input_data": "头痛发烧"}}
2025-11-30 22:01:55,141 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "test_workflow", "status": "completed", "timestamp": "2025-11-30T22:01:55.141296", "details": {"step_name": "symptom_analysis", "matched_symptoms": ["头痛", "发烧"], "processing_time": 1.2}}
2025-11-30 22:01:55,142 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "ValueError", "error_message": "测试错误", "timestamp": "2025-11-30T22:01:55.142296", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\test_enhanced_logging.py\", line 51, in test_enhanced_logging\n    raise ValueError(\"测试错误\")\nValueError: 测试错误\n", "context": {"function": "test_function", "input_data": "测试数据", "user_id": "test_user"}}
2025-11-30 22:01:55,142 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "test_operation", "timestamp": "2025-11-30T22:01:55.142296", "metrics": {"total_time": 5.5, "llm_time": 3.2, "parsing_time": 1.3, "output_length": 200, "model": "deepseek-chat"}}
2025-11-30 22:01:55,142 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:01:55,143 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:01:55.143295", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 250}}
2025-11-30 22:01:55,144 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "ValidationError", "error_message": "1 validation error for ChatOpenAI\n__root__\n  Did not find openai_api_key, please add an environment variable `OPENAI_API_KEY` which contains it, or pass  `openai_api_key` as a named parameter. (type=value_error)", "timestamp": "2025-11-30T22:01:55.144295", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\services\\llm_service.py\", line 29, in __init__\n    self.llm = ChatOpenAI(\n  File \"C:\\Users\\41712\\.conda\\envs\\llm_pro\\lib\\site-packages\\langchain_core\\load\\serializable.py\", line 97, in __init__\n    super().__init__(**kwargs)\n  File \"pydantic\\main.py\", line 341, in pydantic.main.BaseModel.__init__\npydantic.error_wrappers.ValidationError: 1 validation error for ChatOpenAI\n__root__\n  Did not find openai_api_key, please add an environment variable `OPENAI_API_KEY` which contains it, or pass  `openai_api_key` as a named parameter. (type=value_error)\n", "context": {"function": "__init__", "model": "deepseek-chat", "base_url": null}}
2025-11-30 22:01:55,145 - medical_system - ERROR - [enhanced_logger.py:221 - error] - LLM服务测试失败: 1 validation error for ChatOpenAI
__root__
  Did not find openai_api_key, please add an environment variable `OPENAI_API_KEY` which contains it, or pass  `openai_api_key` as a named parameter. (type=value_error)
2025-11-30 22:06:49,684 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:06:49,685 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:06:49.685631", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:06:50,536 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:06:50.536401", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:06:50,536 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:06:53,680 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:06:53,680 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:06:53.680682", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:06:54,417 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:06:54.417787", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:06:54,417 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:08:03,711 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:08:03.711816", "details": {"symptom_text_length": 7, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:08:03,711 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:08:03.711816", "data": {"symptom_text": "我有点头晕咳嗽", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 97}
2025-11-30 22:08:03,712 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:08:03.712817", "details": {}}
2025-11-30 22:08:03,713 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:08:03.713819", "details": {"status": "safe"}}
2025-11-30 22:08:03,714 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:08:03.714819", "details": {}}
2025-11-30 22:08:03,714 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_match_symptoms", "status": "started", "timestamp": "2025-11-30T22:08:03.714819", "details": {"symptom_text": "我有点头晕咳嗽"}}
2025-11-30 22:08:03,714 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_match_symptoms", "status": "completed", "timestamp": "2025-11-30T22:08:03.714819", "details": {"matched_disease": "测试疾病", "confidence": 0.85}}
2025-11-30 22:08:03,715 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:08:03.715818", "details": {"matched_disease": "测试疾病", "confidence": 0.85}}
2025-11-30 22:08:03,715 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:08:03.715818", "details": {"disease_id": "test_disease_001"}}
2025-11-30 22:08:03,717 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:08:03.717819", "details": {"guideline_found": false, "risk_found": false}}
2025-11-30 22:08:03,717 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:08:03.717819", "details": {}}
2025-11-30 22:08:03,717 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:08:03.717819", "details": {"matched_disease": "测试疾病", "has_guideline": false, "has_risk": false, "has_patient_info": true}}
2025-11-30 22:08:03,720 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "ValidationError", "error_message": "1 validation error for SymptomInfo\ndisease_id\n  field required (type=value_error.missing)", "timestamp": "2025-11-30T22:08:03.719146", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 78, in process_query\n    advice_request = self._build_advice_request(\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 169, in _build_advice_request\n    symptom_info=SymptomInfo(\n  File \"pydantic\\main.py\", line 341, in pydantic.main.BaseModel.__init__\npydantic.error_wrappers.ValidationError: 1 validation error for SymptomInfo\ndisease_id\n  field required (type=value_error.missing)\n", "context": {"function": "process_query", "symptom_text": "我有点头晕咳嗽", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:08:03,720 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:08:03.720144", "details": {"error_type": "ValidationError", "error_message": "1 validation error for SymptomInfo\ndisease_id\n  field required (type=value_error.missing)"}}
2025-11-30 22:08:06,011 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:08:06,012 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:08:06.012059", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:08:06,901 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:08:06.901344", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:08:06,902 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:08:06,991 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:08:06.991145", "details": {"symptom_text_length": 7, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:08:06,992 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:08:06.992649", "data": {"symptom_text": "我有点头晕咳嗽", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 97}
2025-11-30 22:08:06,992 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:08:06.992649", "details": {}}
2025-11-30 22:08:06,994 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:08:06.994656", "details": {"status": "safe"}}
2025-11-30 22:08:06,994 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:08:06.994656", "details": {}}
2025-11-30 22:08:06,995 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_match_symptoms", "status": "started", "timestamp": "2025-11-30T22:08:06.995325", "details": {"symptom_text": "我有点头晕咳嗽"}}
2025-11-30 22:08:06,995 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_match_symptoms", "status": "completed", "timestamp": "2025-11-30T22:08:06.995325", "details": {"matched_disease": "测试疾病", "confidence": 0.85}}
2025-11-30 22:08:06,996 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:08:06.996331", "details": {"matched_disease": "测试疾病", "confidence": 0.85}}
2025-11-30 22:08:06,996 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:08:06.996331", "details": {"disease_id": "test_disease_001"}}
2025-11-30 22:08:06,998 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:08:06.998843", "details": {"guideline_found": false, "risk_found": false}}
2025-11-30 22:08:06,999 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:08:06.998843", "details": {}}
2025-11-30 22:08:06,999 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:08:06.999843", "details": {"matched_disease": "测试疾病", "has_guideline": false, "has_risk": false, "has_patient_info": true}}
2025-11-30 22:08:07,000 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "ValidationError", "error_message": "1 validation error for SymptomInfo\ndisease_id\n  field required (type=value_error.missing)", "timestamp": "2025-11-30T22:08:06.999843", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 78, in process_query\n    advice_request = self._build_advice_request(\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 169, in _build_advice_request\n    symptom_info=SymptomInfo(\n  File \"pydantic\\main.py\", line 341, in pydantic.main.BaseModel.__init__\npydantic.error_wrappers.ValidationError: 1 validation error for SymptomInfo\ndisease_id\n  field required (type=value_error.missing)\n", "context": {"function": "process_query", "symptom_text": "我有点头晕咳嗽", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:08:07,001 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:08:07.001845", "details": {"error_type": "ValidationError", "error_message": "1 validation error for SymptomInfo\ndisease_id\n  field required (type=value_error.missing)"}}
2025-11-30 22:08:44,219 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:08:44.219758", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:08:44,220 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:08:44.220756", "data": {"symptom_text": "我有点头晕咳嗽\n", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 99}
2025-11-30 22:08:44,221 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:08:44.221757", "details": {}}
2025-11-30 22:08:44,221 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:08:44.221757", "details": {"status": "safe"}}
2025-11-30 22:08:44,222 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:08:44.222756", "details": {}}
2025-11-30 22:08:44,222 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_match_symptoms", "status": "started", "timestamp": "2025-11-30T22:08:44.222756", "details": {"symptom_text": "我有点头晕咳嗽\n"}}
2025-11-30 22:08:44,222 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_match_symptoms", "status": "completed", "timestamp": "2025-11-30T22:08:44.222756", "details": {"matched_disease": "测试疾病", "confidence": 0.85}}
2025-11-30 22:08:44,222 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:08:44.222756", "details": {"matched_disease": "测试疾病", "confidence": 0.85}}
2025-11-30 22:08:44,223 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:08:44.223755", "details": {"disease_id": "test_disease_001"}}
2025-11-30 22:08:44,225 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:08:44.225755", "details": {"guideline_found": false, "risk_found": false}}
2025-11-30 22:08:44,226 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:08:44.226757", "details": {}}
2025-11-30 22:08:44,226 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:08:44.226757", "details": {"matched_disease": "测试疾病", "has_guideline": false, "has_risk": false, "has_patient_info": true}}
2025-11-30 22:08:44,227 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "ValidationError", "error_message": "1 validation error for SymptomInfo\ndisease_id\n  field required (type=value_error.missing)", "timestamp": "2025-11-30T22:08:44.226757", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 78, in process_query\n    advice_request = self._build_advice_request(\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 169, in _build_advice_request\n    symptom_info=SymptomInfo(\n  File \"pydantic\\main.py\", line 341, in pydantic.main.BaseModel.__init__\npydantic.error_wrappers.ValidationError: 1 validation error for SymptomInfo\ndisease_id\n  field required (type=value_error.missing)\n", "context": {"function": "process_query", "symptom_text": "我有点头晕咳嗽\n", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:08:44,227 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:08:44.227844", "details": {"error_type": "ValidationError", "error_message": "1 validation error for SymptomInfo\ndisease_id\n  field required (type=value_error.missing)"}}
2025-11-30 22:11:19,719 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:11:19,719 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:11:19.719519", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:11:20,431 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:11:20.431307", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:11:20,431 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:12:43,023 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:12:43.023556", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:12:43,023 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:12:43.023556", "details": {"data_dir_exists": true}}
2025-11-30 22:12:43,023 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:12:43,023 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:12:43.023556", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:12:43,614 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:12:43.614476", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:12:43,615 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:13:37,490 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:13:37.490557", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:13:37,491 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:13:37.491551", "details": {"data_dir_exists": true}}
2025-11-30 22:13:37,491 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:13:37,491 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:13:37.491551", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:13:38,031 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:13:38.031437", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:13:38,032 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:15:11,139 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:15:11.139712", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:15:11,139 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:15:11.139712", "details": {"data_dir_exists": true}}
2025-11-30 22:15:11,139 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:15:11,140 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:15:11.140712", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:15:11,658 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:15:11.658547", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:15:11,659 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:16:17,800 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:16:17.800211", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:16:17,800 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:16:17.800211", "details": {"data_dir_exists": true}}
2025-11-30 22:16:17,800 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:16:17,801 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:16:17.800211", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:16:18,317 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:16:18.317695", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:16:18,317 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:16:53,048 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:16:53.047270", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:16:53,049 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:16:53.049266", "details": {"data_dir_exists": true}}
2025-11-30 22:16:53,049 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:16:53,050 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:16:53.050265", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:16:54,196 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:16:54.196743", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:16:54,197 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:17:48,765 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:17:48.765377", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:17:48,766 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:17:48.766377", "details": {"data_dir_exists": true}}
2025-11-30 22:17:48,766 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:17:48,767 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:17:48.767377", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:17:48,835 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:17:48.835190", "details": {}}
2025-11-30 22:17:48,836 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:17:48.836190", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:17:49,346 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:17:49.346957", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:17:49,347 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:17:49.347955", "details": {}}
2025-11-30 22:17:49,348 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:17:49.348955", "details": {"instructions_length": 1264}}
2025-11-30 22:17:49,349 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:17:49.348955", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:17:49,349 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:19:46,554 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:19:46.554791", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:19:46,556 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:19:46.556201", "details": {"data_dir_exists": true}}
2025-11-30 22:19:46,556 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:19:46,556 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:19:46.556201", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 250}}
2025-11-30 22:19:46,558 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "ValidationError", "error_message": "1 validation error for ChatOpenAI\n__root__\n  Did not find openai_api_key, please add an environment variable `OPENAI_API_KEY` which contains it, or pass  `openai_api_key` as a named parameter. (type=value_error)", "timestamp": "2025-11-30T22:19:46.557201", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\services\\llm_service.py\", line 29, in __init__\n    self.llm = ChatOpenAI(\n  File \"C:\\Users\\41712\\.conda\\envs\\llm_pro\\lib\\site-packages\\langchain_core\\load\\serializable.py\", line 97, in __init__\n    super().__init__(**kwargs)\n  File \"pydantic\\main.py\", line 341, in pydantic.main.BaseModel.__init__\npydantic.error_wrappers.ValidationError: 1 validation error for ChatOpenAI\n__root__\n  Did not find openai_api_key, please add an environment variable `OPENAI_API_KEY` which contains it, or pass  `openai_api_key` as a named parameter. (type=value_error)\n", "context": {"function": "__init__", "model": "deepseek-chat", "base_url": null}}
2025-11-30 22:19:48,087 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:19:48.087900", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:19:48,087 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:19:48.087900", "details": {"data_dir_exists": true}}
2025-11-30 22:19:48,088 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:19:48,088 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:19:48.088901", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:19:48,125 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:19:48.125434", "details": {}}
2025-11-30 22:19:48,126 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:19:48.126432", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:19:48,703 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:19:48.703489", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:19:48,703 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:19:48.703489", "details": {}}
2025-11-30 22:19:48,704 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:19:48.704488", "details": {"instructions_length": 1264}}
2025-11-30 22:19:48,704 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:19:48.704488", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:19:48,704 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:21:07,798 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:21:07.798055", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:21:07,798 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:21:07.798055", "details": {"data_dir_exists": true}}
2025-11-30 22:21:07,799 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:21:07,799 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:21:07.799055", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:21:07,861 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:21:07.861287", "details": {}}
2025-11-30 22:21:07,861 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:21:07.861287", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:21:08,615 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:21:08.615916", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:21:08,615 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:21:08.615916", "details": {}}
2025-11-30 22:21:08,617 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:21:08.617914", "details": {"instructions_length": 1264}}
2025-11-30 22:21:08,617 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:21:08.617914", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:21:08,617 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:21:28,249 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:21:28.249448", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:21:28,250 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:21:28.250950", "details": {"data_dir_exists": true}}
2025-11-30 22:21:28,250 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:21:28,251 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:21:28.251452", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:21:28,287 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:21:28.287974", "details": {}}
2025-11-30 22:21:28,288 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:21:28.288974", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:21:28,954 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:21:28.954731", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:21:28,954 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:21:28.954731", "details": {}}
2025-11-30 22:21:28,956 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:21:28.956731", "details": {"instructions_length": 1264}}
2025-11-30 22:21:28,956 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:21:28.956731", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:21:28,957 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:21:55,922 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:21:55.921004", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:21:55,922 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:21:55.922009", "details": {"data_dir_exists": true}}
2025-11-30 22:21:55,922 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:21:55,923 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:21:55.923009", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:21:55,976 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:21:55.975067", "details": {}}
2025-11-30 22:21:55,976 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:21:55.976067", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:21:56,643 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:21:56.643234", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:21:56,643 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:21:56.643234", "details": {}}
2025-11-30 22:21:56,644 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:21:56.644233", "details": {"instructions_length": 1264}}
2025-11-30 22:21:56,645 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:21:56.645232", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:21:56,645 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:22:01,345 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:22:01.345542", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:22:01,345 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:22:01.345542", "details": {"data_dir_exists": true}}
2025-11-30 22:22:01,346 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:22:01,346 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:22:01.346541", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 250}}
2025-11-30 22:22:01,346 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - Running in test mode - no API key provided, will use mock responses
2025-11-30 22:22:01,346 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "test_mode_enabled", "timestamp": "2025-11-30T22:22:01.346541", "details": {"reason": "no_api_key"}}
2025-11-30 22:22:01,347 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:22:01.347542", "details": {}}
2025-11-30 22:22:01,347 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:22:01.347542", "details": {"model": "deepseek-chat", "has_api_key": false, "has_base_url": false}}
2025-11-30 22:22:01,347 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - API密钥未配置，将使用基础解析器
2025-11-30 22:22:01,347 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:22:01.347542", "details": {}}
2025-11-30 22:22:01,349 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:22:01.349542", "details": {"instructions_length": 1264}}
2025-11-30 22:22:01,349 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:22:01.349542", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:22:01,349 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:22:01,351 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:22:01.351048", "details": {"symptom_text_length": 7, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:22:01,351 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:22:01.351048", "data": {"symptom_text": "我有点头晕咳嗽", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 97}
2025-11-30 22:22:01,351 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:22:01.351048", "details": {}}
2025-11-30 22:22:01,352 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "AttributeError", "error_message": "'SecurityService' object has no attribute 'check_content'", "timestamp": "2025-11-30T22:22:01.352055", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 41, in process_query\n    security_result = await self.security_service.check_content(symptom_text)\nAttributeError: 'SecurityService' object has no attribute 'check_content'\n", "context": {"function": "process_query", "symptom_text": "我有点头晕咳嗽", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:22:01,352 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:22:01.352055", "details": {"error_type": "AttributeError", "error_message": "'SecurityService' object has no attribute 'check_content'"}}
2025-11-30 22:22:01,353 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:22:01.353054", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:22:01,354 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:22:01.354055", "data": {"symptom_text": "我发烧了，头很痛", "patient_info": {"age": 30, "gender": "女", "special_conditions": "孕妇"}}, "data_size": 100}
2025-11-30 22:22:01,354 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:22:01.354055", "details": {}}
2025-11-30 22:22:01,355 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "AttributeError", "error_message": "'SecurityService' object has no attribute 'check_content'", "timestamp": "2025-11-30T22:22:01.354055", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 41, in process_query\n    security_result = await self.security_service.check_content(symptom_text)\nAttributeError: 'SecurityService' object has no attribute 'check_content'\n", "context": {"function": "process_query", "symptom_text": "我发烧了，头很痛", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:22:01,355 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:22:01.355056", "details": {"error_type": "AttributeError", "error_message": "'SecurityService' object has no attribute 'check_content'"}}
2025-11-30 22:22:01,356 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:22:01.356054", "details": {"symptom_text_length": 9, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:22:01,356 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:22:01.356054", "data": {"symptom_text": "胸口很痛，呼吸困难", "patient_info": {"age": 55, "gender": "男", "special_conditions": "高血压"}}, "data_size": 102}
2025-11-30 22:22:01,357 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:22:01.357054", "details": {}}
2025-11-30 22:22:01,357 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "AttributeError", "error_message": "'SecurityService' object has no attribute 'check_content'", "timestamp": "2025-11-30T22:22:01.357054", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 41, in process_query\n    security_result = await self.security_service.check_content(symptom_text)\nAttributeError: 'SecurityService' object has no attribute 'check_content'\n", "context": {"function": "process_query", "symptom_text": "胸口很痛，呼吸困难", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:22:01,358 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:22:01.358056", "details": {"error_type": "AttributeError", "error_message": "'SecurityService' object has no attribute 'check_content'"}}
2025-11-30 22:22:01,359 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:22:01.359055", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:22:01,359 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:22:01.359055", "data": {"symptom_text": "恶心想吐，肚子痛", "patient_info": {"age": 20, "gender": "女", "special_conditions": ""}}, "data_size": 98}
2025-11-30 22:22:01,359 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:22:01.359055", "details": {}}
2025-11-30 22:22:01,360 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "AttributeError", "error_message": "'SecurityService' object has no attribute 'check_content'", "timestamp": "2025-11-30T22:22:01.359055", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 41, in process_query\n    security_result = await self.security_service.check_content(symptom_text)\nAttributeError: 'SecurityService' object has no attribute 'check_content'\n", "context": {"function": "process_query", "symptom_text": "恶心想吐，肚子痛", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:22:01,360 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:22:01.360056", "details": {"error_type": "AttributeError", "error_message": "'SecurityService' object has no attribute 'check_content'"}}
2025-11-30 22:22:44,533 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:22:44.533144", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:22:44,534 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:22:44.534067", "details": {"data_dir_exists": true}}
2025-11-30 22:22:44,534 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:22:44,534 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:22:44.534067", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:22:44,586 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:22:44.586561", "details": {}}
2025-11-30 22:22:44,587 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:22:44.587559", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:22:45,356 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:22:45.356677", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:22:45,356 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:22:45.356677", "details": {}}
2025-11-30 22:22:45,358 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:22:45.358676", "details": {"instructions_length": 1264}}
2025-11-30 22:22:45,359 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:22:45.359674", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:22:45,359 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:23:02,608 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:23:02.608459", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:23:02,609 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:23:02.609460", "details": {"data_dir_exists": true}}
2025-11-30 22:23:02,609 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:23:02,609 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:23:02.609460", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:23:02,667 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:23:02.667318", "details": {}}
2025-11-30 22:23:02,668 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:23:02.668317", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:23:03,141 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:23:03.141655", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:23:03,142 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:23:03.142660", "details": {}}
2025-11-30 22:23:03,143 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:23:03.143658", "details": {"instructions_length": 1264}}
2025-11-30 22:23:03,143 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:23:03.143658", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:23:03,143 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:23:16,138 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:23:16.138546", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:23:16,139 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:23:16.138546", "details": {"data_dir_exists": true}}
2025-11-30 22:23:16,139 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:23:16,139 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:23:16.139544", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:23:16,171 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:23:16.171055", "details": {}}
2025-11-30 22:23:16,171 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:23:16.171558", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:23:16,713 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:23:16.713106", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:23:16,713 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:23:16.713106", "details": {}}
2025-11-30 22:23:16,715 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:23:16.715110", "details": {"instructions_length": 1264}}
2025-11-30 22:23:16,715 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:23:16.715110", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:23:16,716 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:23:32,799 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:23:32.799609", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:23:32,801 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:23:32.801139", "details": {"data_dir_exists": true}}
2025-11-30 22:23:32,802 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:23:32,802 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:23:32.802151", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:23:32,875 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:23:32.875935", "details": {}}
2025-11-30 22:23:32,876 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:23:32.876932", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:23:33,847 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:23:33.847517", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:23:33,848 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:23:33.848517", "details": {}}
2025-11-30 22:23:33,849 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:23:33.849517", "details": {"instructions_length": 1264}}
2025-11-30 22:23:33,851 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:23:33.851024", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:23:33,851 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:23:39,498 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:23:39.498828", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:23:39,498 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:23:39.498828", "details": {"data_dir_exists": true}}
2025-11-30 22:23:39,498 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:23:39,499 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:23:39.499828", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:23:39,531 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:23:39.531050", "details": {}}
2025-11-30 22:23:39,531 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:23:39.531050", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:23:39,963 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:23:39.963758", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:23:39,963 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:23:39.963758", "details": {}}
2025-11-30 22:23:39,965 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:23:39.965758", "details": {"instructions_length": 1264}}
2025-11-30 22:23:39,965 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:23:39.965758", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:23:39,965 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:23:44,523 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:23:44.523001", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:23:44,524 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:23:44.524002", "details": {"data_dir_exists": true}}
2025-11-30 22:23:44,524 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:23:44,525 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:23:44.524002", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 250}}
2025-11-30 22:23:44,525 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - Running in test mode - no API key provided, will use mock responses
2025-11-30 22:23:44,525 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "test_mode_enabled", "timestamp": "2025-11-30T22:23:44.525505", "details": {"reason": "no_api_key"}}
2025-11-30 22:23:44,525 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:23:44.525505", "details": {}}
2025-11-30 22:23:44,525 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:23:44.525505", "details": {"model": "deepseek-chat", "has_api_key": false, "has_base_url": false}}
2025-11-30 22:23:44,526 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - API密钥未配置，将使用基础解析器
2025-11-30 22:23:44,526 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:23:44.526510", "details": {}}
2025-11-30 22:23:44,527 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:23:44.527510", "details": {"instructions_length": 1264}}
2025-11-30 22:23:44,528 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:23:44.527510", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:23:44,528 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:23:44,528 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:23:44.528510", "details": {"symptom_text_length": 7, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:23:44,529 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:23:44.529511", "data": {"symptom_text": "我有点头晕咳嗽", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 97}
2025-11-30 22:23:44,529 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:23:44.529511", "details": {}}
2025-11-30 22:23:44,529 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:23:44.529511", "details": {"status": "safe"}}
2025-11-30 22:23:44,529 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:23:44.529511", "details": {}}
2025-11-30 22:23:44,531 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:23:44.531017", "details": {"symptom_text": "我有点头晕咳嗽"}}
2025-11-30 22:23:44,531 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:23:44.531017", "details": {"extracted_keywords": ["头晕", "咳嗽"], "keyword_count": 2}}
2025-11-30 22:23:44,531 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:23:44.531017", "details": {"matched_diseases": ["D04", "D01"], "total_matches": 2}}
2025-11-30 22:23:44,531 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:23:44.531017", "details": {"best_disease": "D04", "confidence": 0.9, "matched_symptoms": ["头晕"]}}
2025-11-30 22:23:44,531 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:23:44.531017", "details": {"matched_disease": "高血压急症风险", "confidence": 0.9}}
2025-11-30 22:23:44,532 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:23:44.532023", "details": {"disease_id": "D04"}}
2025-11-30 22:23:44,532 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:23:44.532023", "details": {"disease_id": "D04", "data_type": "guideline"}}
2025-11-30 22:23:44,532 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:23:44.532023", "details": {}}
2025-11-30 22:23:44,532 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:23:44.532023", "details": {"filename": "guideline.json"}}
2025-11-30 22:23:44,533 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:23:44.533023", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:23:44,534 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:23:44.534024", "details": {"disease_id": "D04", "data_type": "risk"}}
2025-11-30 22:23:44,534 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:23:44.534024", "details": {}}
2025-11-30 22:23:44,534 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:23:44.534024", "details": {"filename": "disease_info.json"}}
2025-11-30 22:23:44,535 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:23:44.535023", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:23:44,536 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:23:44.536022", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:23:44,536 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:23:44.536022", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:23:44,537 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:23:44.537024", "details": {"data_count": 5}}
2025-11-30 22:23:44,537 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:23:44.537024", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:23:44,537 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:23:44.537024", "details": {"disease_id": "D04", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:23:44,537 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:23:44.537024", "details": {"data_count": 5}}
2025-11-30 22:23:44,538 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:23:44.538023", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:23:44,538 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:23:44.538023", "details": {"disease_id": "D04", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:23:44,538 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:23:44.538023", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:23:44,538 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:23:44.538023", "details": {}}
2025-11-30 22:23:44,538 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:23:44.538023", "details": {"matched_disease": "高血压急症风险", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:23:44,539 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:23:44.539023", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:23:44,539 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:23:44.539023", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:23:44,539 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:23:44.539023", "details": {}}
2025-11-30 22:23:44,539 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:23:44.539023", "details": {"has_patient_info": true, "disease_name": "高血压急症风险", "matched_symptoms_count": 1}}
2025-11-30 22:23:44,539 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:23:44.539023", "details": {}}
2025-11-30 22:23:44,540 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:23:44.539023", "details": {"instructions_length": 1264}}
2025-11-30 22:23:44,540 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:23:44.540023", "details": {"prompt_length": 1512, "has_format_instructions": true}}
2025-11-30 22:23:44,540 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:23:44.540023", "prompt_length": 1512, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:23:44,540 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:23:44.540023", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:23:44,540 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:23:44.540023", "details": {"disease_name": "高血压急症风险", "urgency": "高"}}
2025-11-30 22:23:44,541 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:23:44.541024", "details": {"response_length": 325, "has_json_format": true}}
2025-11-30 22:23:44,541 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.001 seconds
2025-11-30 22:23:44,541 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:23:44.541024", "details": {"response_length": 325, "duration": 0.0010008811950683594, "model": "deepseek-chat"}}
2025-11-30 22:23:44,541 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "UnboundLocalError", "error_message": "local variable 'response' referenced before assignment", "timestamp": "2025-11-30T22:23:44.541530", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\services\\llm_service.py\", line 179, in generate_structured_advice\n    tokens_used=response.llm_output.get(\"token_usage\", {}).get(\"total_tokens\") if hasattr(response, \"llm_output\") else None,\nUnboundLocalError: local variable 'response' referenced before assignment\n", "context": {"function": "generate_structured_advice", "model": "deepseek-chat", "disease_name": "高血压急症风险", "has_patient_info": true}}
2025-11-30 22:23:44,542 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "failed", "timestamp": "2025-11-30T22:23:44.542534", "details": {"error_type": "UnboundLocalError", "error_message": "local variable 'response' referenced before assignment"}}
2025-11-30 22:23:44,542 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "fallback_response", "status": "started", "timestamp": "2025-11-30T22:23:44.542534", "details": {"disease_name": "高血压急症风险"}}
2025-11-30 22:23:44,542 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "fallback_response", "status": "completed", "timestamp": "2025-11-30T22:23:44.542534", "details": {"assessment": "根据症状描述，疑似高血压急症风险"}}
2025-11-30 22:23:44,543 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:23:44.543201", "details": {"advice_generated": true, "assessment_length": 16}}
2025-11-30 22:23:44,543 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:23:44.543201", "details": {}}
2025-11-30 22:23:44,544 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "AttributeError", "error_message": "'MedicalAdviceResponse' object has no attribute 'model_dump_json'", "timestamp": "2025-11-30T22:23:44.543201", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 98, in process_query\n    advice=structured_advice.model_dump_json() if structured_advice else None,\nAttributeError: 'MedicalAdviceResponse' object has no attribute 'model_dump_json'\n", "context": {"function": "process_query", "symptom_text": "我有点头晕咳嗽", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:23:44,544 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:23:44.544205", "details": {"error_type": "AttributeError", "error_message": "'MedicalAdviceResponse' object has no attribute 'model_dump_json'"}}
2025-11-30 22:23:44,545 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:23:44.545208", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:23:44,545 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:23:44.545208", "data": {"symptom_text": "我发烧了，头很痛", "patient_info": {"age": 30, "gender": "女", "special_conditions": "孕妇"}}, "data_size": 100}
2025-11-30 22:23:44,545 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:23:44.545208", "details": {}}
2025-11-30 22:23:44,545 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:23:44.545208", "details": {"status": "safe"}}
2025-11-30 22:23:44,546 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:23:44.546205", "details": {}}
2025-11-30 22:23:44,546 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:23:44.546205", "details": {"symptom_text": "我发烧了，头很痛"}}
2025-11-30 22:23:44,546 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:23:44.546205", "details": {"extracted_keywords": ["发烧"], "keyword_count": 1}}
2025-11-30 22:23:44,546 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:23:44.546205", "details": {"matched_diseases": ["D01"], "total_matches": 1}}
2025-11-30 22:23:44,546 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:23:44.546205", "details": {"best_disease": "D01", "confidence": 0.8, "matched_symptoms": ["发烧"]}}
2025-11-30 22:23:44,546 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:23:44.546205", "details": {"matched_disease": "普通感冒", "confidence": 0.8}}
2025-11-30 22:23:44,546 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:23:44.546205", "details": {"disease_id": "D01"}}
2025-11-30 22:23:44,547 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:23:44.547205", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:23:44,547 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:23:44.547205", "details": {}}
2025-11-30 22:23:44,547 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:23:44.547205", "details": {"filename": "guideline.json"}}
2025-11-30 22:23:44,547 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:23:44.547205", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:23:44,547 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:23:44.547205", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:23:44,548 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:23:44.548206", "details": {}}
2025-11-30 22:23:44,548 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:23:44.548206", "details": {"filename": "disease_info.json"}}
2025-11-30 22:23:44,548 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:23:44.548206", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:23:44,549 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:23:44.549209", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:23:44,550 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:23:44.550205", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:23:44,550 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:23:44.550205", "details": {"data_count": 5}}
2025-11-30 22:23:44,550 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:23:44.550205", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:23:44,550 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:23:44.550205", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:23:44,551 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:23:44.551205", "details": {"data_count": 5}}
2025-11-30 22:23:44,551 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:23:44.551205", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:23:44,551 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:23:44.551205", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:23:44,551 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:23:44.551205", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:23:44,551 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:23:44.551205", "details": {}}
2025-11-30 22:23:44,551 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:23:44.551205", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:23:44,552 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:23:44.552359", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:23:44,552 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:23:44.552359", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:23:44,552 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:23:44.552359", "details": {}}
2025-11-30 22:23:44,552 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:23:44.552359", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:23:44,552 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:23:44.552359", "details": {}}
2025-11-30 22:23:44,553 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:23:44.553359", "details": {"instructions_length": 1264}}
2025-11-30 22:23:44,553 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:23:44.553359", "details": {"prompt_length": 1499, "has_format_instructions": true}}
2025-11-30 22:23:44,553 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:23:44.553359", "prompt_length": 1499, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:23:44,553 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:23:44.553359", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:23:44,553 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:23:44.553359", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:23:44,554 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:23:44.554361", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:23:44,554 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.001 seconds
2025-11-30 22:23:44,554 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:23:44.554361", "details": {"response_length": 323, "duration": 0.001001119613647461, "model": "deepseek-chat"}}
2025-11-30 22:23:44,554 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "UnboundLocalError", "error_message": "local variable 'response' referenced before assignment", "timestamp": "2025-11-30T22:23:44.554361", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\services\\llm_service.py\", line 179, in generate_structured_advice\n    tokens_used=response.llm_output.get(\"token_usage\", {}).get(\"total_tokens\") if hasattr(response, \"llm_output\") else None,\nUnboundLocalError: local variable 'response' referenced before assignment\n", "context": {"function": "generate_structured_advice", "model": "deepseek-chat", "disease_name": "普通感冒", "has_patient_info": true}}
2025-11-30 22:23:44,555 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "failed", "timestamp": "2025-11-30T22:23:44.555360", "details": {"error_type": "UnboundLocalError", "error_message": "local variable 'response' referenced before assignment"}}
2025-11-30 22:23:44,555 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "fallback_response", "status": "started", "timestamp": "2025-11-30T22:23:44.555360", "details": {"disease_name": "普通感冒"}}
2025-11-30 22:23:44,555 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "fallback_response", "status": "completed", "timestamp": "2025-11-30T22:23:44.555360", "details": {"assessment": "根据症状描述，疑似普通感冒"}}
2025-11-30 22:23:44,555 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:23:44.555360", "details": {"advice_generated": true, "assessment_length": 13}}
2025-11-30 22:23:44,555 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:23:44.555360", "details": {}}
2025-11-30 22:23:44,556 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "AttributeError", "error_message": "'MedicalAdviceResponse' object has no attribute 'model_dump_json'", "timestamp": "2025-11-30T22:23:44.555360", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 98, in process_query\n    advice=structured_advice.model_dump_json() if structured_advice else None,\nAttributeError: 'MedicalAdviceResponse' object has no attribute 'model_dump_json'\n", "context": {"function": "process_query", "symptom_text": "我发烧了，头很痛", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:23:44,556 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:23:44.556358", "details": {"error_type": "AttributeError", "error_message": "'MedicalAdviceResponse' object has no attribute 'model_dump_json'"}}
2025-11-30 22:23:44,556 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:23:44.556358", "details": {"symptom_text_length": 9, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:23:44,557 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:23:44.557359", "data": {"symptom_text": "胸口很痛，呼吸困难", "patient_info": {"age": 55, "gender": "男", "special_conditions": "高血压"}}, "data_size": 102}
2025-11-30 22:23:44,557 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:23:44.557359", "details": {}}
2025-11-30 22:23:44,557 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:23:44.557359", "details": {"status": "safe"}}
2025-11-30 22:23:44,557 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:23:44.557359", "details": {}}
2025-11-30 22:23:44,557 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:23:44.557359", "details": {"symptom_text": "胸口很痛，呼吸困难"}}
2025-11-30 22:23:44,558 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:23:44.558360", "details": {"extracted_keywords": [], "keyword_count": 0}}
2025-11-30 22:23:44,558 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 未提取到任何关键词
2025-11-30 22:23:44,558 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:23:44.558958", "details": {"matched_disease": "普通感冒", "confidence": 0.3}}
2025-11-30 22:23:44,558 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:23:44.558958", "details": {"disease_id": "D01"}}
2025-11-30 22:23:44,558 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:23:44.558958", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:23:44,559 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:23:44.559965", "details": {}}
2025-11-30 22:23:44,559 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:23:44.559965", "details": {"filename": "guideline.json"}}
2025-11-30 22:23:44,559 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:23:44.559965", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:23:44,560 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:23:44.560962", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:23:44,560 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:23:44.560962", "details": {}}
2025-11-30 22:23:44,560 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:23:44.560962", "details": {"filename": "disease_info.json"}}
2025-11-30 22:23:44,560 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:23:44.560962", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:23:44,562 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:23:44.562021", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:23:44,562 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:23:44.562021", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:23:44,563 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:23:44.563021", "details": {"data_count": 5}}
2025-11-30 22:23:44,563 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:23:44.563021", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:23:44,563 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:23:44.563021", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:23:44,563 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:23:44.563021", "details": {"data_count": 5}}
2025-11-30 22:23:44,563 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:23:44.563021", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:23:44,564 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:23:44.563021", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:23:44,564 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:23:44.564021", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:23:44,564 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:23:44.564021", "details": {}}
2025-11-30 22:23:44,564 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:23:44.564021", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:23:44,565 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:23:44.565020", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:23:44,565 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:23:44.565020", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:23:44,565 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:23:44.565020", "details": {}}
2025-11-30 22:23:44,565 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:23:44.565020", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:23:44,565 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:23:44.565020", "details": {}}
2025-11-30 22:23:44,565 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:23:44.565020", "details": {"instructions_length": 1264}}
2025-11-30 22:23:44,566 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:23:44.566022", "details": {"prompt_length": 1502, "has_format_instructions": true}}
2025-11-30 22:23:44,566 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:23:44.566022", "prompt_length": 1502, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:23:44,566 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:23:44.566022", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:23:44,566 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:23:44.566022", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:23:44,566 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:23:44.566022", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:23:44,567 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.001 seconds
2025-11-30 22:23:44,567 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:23:44.567022", "details": {"response_length": 323, "duration": 0.0009999275207519531, "model": "deepseek-chat"}}
2025-11-30 22:23:44,567 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "UnboundLocalError", "error_message": "local variable 'response' referenced before assignment", "timestamp": "2025-11-30T22:23:44.567022", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\services\\llm_service.py\", line 179, in generate_structured_advice\n    tokens_used=response.llm_output.get(\"token_usage\", {}).get(\"total_tokens\") if hasattr(response, \"llm_output\") else None,\nUnboundLocalError: local variable 'response' referenced before assignment\n", "context": {"function": "generate_structured_advice", "model": "deepseek-chat", "disease_name": "普通感冒", "has_patient_info": true}}
2025-11-30 22:23:44,567 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "failed", "timestamp": "2025-11-30T22:23:44.567022", "details": {"error_type": "UnboundLocalError", "error_message": "local variable 'response' referenced before assignment"}}
2025-11-30 22:23:44,567 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "fallback_response", "status": "started", "timestamp": "2025-11-30T22:23:44.567022", "details": {"disease_name": "普通感冒"}}
2025-11-30 22:23:44,568 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "fallback_response", "status": "completed", "timestamp": "2025-11-30T22:23:44.568020", "details": {"assessment": "根据症状描述，疑似普通感冒"}}
2025-11-30 22:23:44,568 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:23:44.568020", "details": {"advice_generated": true, "assessment_length": 13}}
2025-11-30 22:23:44,568 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:23:44.568020", "details": {}}
2025-11-30 22:23:44,568 - medical_system - ERROR - [enhanced_logger.py:221 - error] - ERROR_CONTEXT: {"type": "error_with_context", "error_type": "AttributeError", "error_message": "'MedicalAdviceResponse' object has no attribute 'model_dump_json'", "timestamp": "2025-11-30T22:23:44.568020", "traceback": "Traceback (most recent call last):\n  File \"D:\\code\\llm_pra\\day_07\\controllers\\medical_controller.py\", line 98, in process_query\n    advice=structured_advice.model_dump_json() if structured_advice else None,\nAttributeError: 'MedicalAdviceResponse' object has no attribute 'model_dump_json'\n", "context": {"function": "process_query", "symptom_text": "胸口很痛，呼吸困难", "patient_info_keys": ["age", "gender", "special_conditions"]}}
2025-11-30 22:23:44,569 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "failed", "timestamp": "2025-11-30T22:23:44.569021", "details": {"error_type": "AttributeError", "error_message": "'MedicalAdviceResponse' object has no attribute 'model_dump_json'"}}
2025-11-30 22:23:44,570 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:23:44.570021", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:23:44,570 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:23:44.570021", "data": {"symptom_text": "恶心想吐，肚子痛", "patient_info": {"age": 20, "gender": "女", "special_conditions": ""}}, "data_size": 98}
2025-11-30 22:23:44,570 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:23:44.570021", "details": {}}
2025-11-30 22:23:44,571 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:23:44.571021", "details": {"status": "unsafe"}}
2025-11-30 22:23:44,571 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 内容安全检查失败: 输入内容不符合医疗咨询要求
2025-11-30 22:24:15,024 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:24:15.024635", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:24:15,025 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:24:15.025634", "details": {"data_dir_exists": true}}
2025-11-30 22:24:15,025 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:24:15,026 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:24:15.026635", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:24:15,072 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:24:15.072582", "details": {}}
2025-11-30 22:24:15,072 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:24:15.072582", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:24:15,741 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:24:15.741109", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:24:15,742 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:24:15.742116", "details": {}}
2025-11-30 22:24:15,744 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:24:15.744123", "details": {"instructions_length": 1264}}
2025-11-30 22:24:15,744 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:24:15.744123", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:24:15,744 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:24:36,340 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:24:36.340961", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:24:36,341 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:24:36.341967", "details": {"data_dir_exists": true}}
2025-11-30 22:24:36,341 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:24:36,342 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:24:36.341967", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:24:36,375 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:24:36.375509", "details": {}}
2025-11-30 22:24:36,375 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:24:36.375509", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:24:36,923 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:24:36.923330", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:24:36,924 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:24:36.924336", "details": {}}
2025-11-30 22:24:36,925 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:24:36.925328", "details": {"instructions_length": 1264}}
2025-11-30 22:24:36,925 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:24:36.925328", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:24:36,925 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:25:37,128 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:25:37.128001", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:25:37,129 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:25:37.129000", "details": {"data_dir_exists": true}}
2025-11-30 22:25:37,129 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:25:37,129 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:25:37.129000", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:25:37,162 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:25:37.162932", "details": {}}
2025-11-30 22:25:37,164 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:25:37.164057", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:25:37,615 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:25:37.615094", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:25:37,616 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:25:37.616097", "details": {}}
2025-11-30 22:25:37,617 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:25:37.617097", "details": {"instructions_length": 1264}}
2025-11-30 22:25:37,617 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:25:37.617097", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:25:37,617 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:25:48,510 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:25:48.510992", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:25:48,510 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:25:48.510992", "details": {"data_dir_exists": true}}
2025-11-30 22:25:48,512 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:25:48,512 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:25:48.512117", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:25:48,579 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:25:48.579667", "details": {}}
2025-11-30 22:25:48,579 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:25:48.579667", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:25:49,470 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:25:49.470933", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:25:49,471 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:25:49.471440", "details": {}}
2025-11-30 22:25:49,473 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:25:49.473444", "details": {"instructions_length": 1264}}
2025-11-30 22:25:49,473 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:25:49.473444", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:25:49,474 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:26:07,537 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:26:07.537719", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:26:07,538 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:26:07.538726", "details": {"data_dir_exists": true}}
2025-11-30 22:26:07,538 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:26:07,538 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:26:07.538726", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:26:07,584 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:26:07.583652", "details": {}}
2025-11-30 22:26:07,585 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:26:07.584645", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:26:08,301 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:26:08.301696", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:26:08,301 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:26:08.301696", "details": {}}
2025-11-30 22:26:08,303 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:26:08.303699", "details": {"instructions_length": 1264}}
2025-11-30 22:26:08,303 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:26:08.303699", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:26:08,304 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:27:57,259 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:27:57.259600", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:27:57,259 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:27:57.259600", "details": {"data_dir_exists": true}}
2025-11-30 22:27:57,259 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:27:57,261 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:27:57.259600", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:27:57,299 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:27:57.299261", "details": {}}
2025-11-30 22:27:57,299 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:27:57.299261", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:27:57,787 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:27:57.787262", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:27:57,788 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:27:57.788257", "details": {}}
2025-11-30 22:27:57,789 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:27:57.789258", "details": {"instructions_length": 1264}}
2025-11-30 22:27:57,789 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:27:57.789258", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:27:57,789 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:27:59,056 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:27:59.056530", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:27:59,057 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:27:59.057534", "details": {"data_dir_exists": true}}
2025-11-30 22:27:59,057 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:27:59,057 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:27:59.057534", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:27:59,102 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:27:59.102438", "details": {}}
2025-11-30 22:27:59,103 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:27:59.103439", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:27:59,753 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:27:59.753954", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:27:59,754 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:27:59.753954", "details": {}}
2025-11-30 22:27:59,755 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:27:59.755954", "details": {"instructions_length": 1264}}
2025-11-30 22:27:59,756 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:27:59.756960", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:27:59,757 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:28:02,926 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:28:02.926497", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:28:02,927 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:28:02.927494", "details": {"data_dir_exists": true}}
2025-11-30 22:28:02,927 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:28:02,928 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:28:02.928498", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:28:03,004 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:28:03.004287", "details": {}}
2025-11-30 22:28:03,005 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:28:03.005287", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:28:03,693 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:28:03.693190", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:28:03,693 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:28:03.693190", "details": {}}
2025-11-30 22:28:03,695 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:28:03.695183", "details": {"instructions_length": 1264}}
2025-11-30 22:28:03,695 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:28:03.695183", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:28:03,695 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:28:59,221 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:28:59.221122", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:28:59,221 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:28:59.221122", "details": {"data_dir_exists": true}}
2025-11-30 22:28:59,221 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:28:59,221 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:28:59.221122", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 250}}
2025-11-30 22:28:59,221 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - Running in test mode - no API key provided, will use mock responses
2025-11-30 22:28:59,221 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "test_mode_enabled", "timestamp": "2025-11-30T22:28:59.221122", "details": {"reason": "no_api_key"}}
2025-11-30 22:28:59,222 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:28:59.222284", "details": {}}
2025-11-30 22:28:59,222 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:28:59.222284", "details": {"model": "deepseek-chat", "has_api_key": false, "has_base_url": false}}
2025-11-30 22:28:59,222 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - API密钥未配置，将使用基础解析器
2025-11-30 22:28:59,222 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:28:59.222284", "details": {}}
2025-11-30 22:28:59,224 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:28:59.224286", "details": {"instructions_length": 1264}}
2025-11-30 22:28:59,224 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:28:59.224286", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:28:59,224 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:28:59,225 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:28:59.225284", "details": {"symptom_text_length": 7, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:28:59,225 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:28:59.225284", "data": {"symptom_text": "我有点头晕咳嗽", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 97}
2025-11-30 22:28:59,225 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:28:59.225284", "details": {}}
2025-11-30 22:28:59,226 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:28:59.226285", "details": {"status": "safe"}}
2025-11-30 22:28:59,226 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:28:59.226285", "details": {}}
2025-11-30 22:28:59,226 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:28:59.226285", "details": {"symptom_text": "我有点头晕咳嗽"}}
2025-11-30 22:28:59,226 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:28:59.226285", "details": {"extracted_keywords": ["头晕", "咳嗽"], "keyword_count": 2}}
2025-11-30 22:28:59,226 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:28:59.226285", "details": {"matched_diseases": ["D04", "D01"], "total_matches": 2}}
2025-11-30 22:28:59,226 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:28:59.226285", "details": {"best_disease": "D04", "confidence": 0.9, "matched_symptoms": ["头晕"]}}
2025-11-30 22:28:59,226 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:28:59.226285", "details": {"matched_disease": "高血压急症风险", "confidence": 0.9}}
2025-11-30 22:28:59,227 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:28:59.227284", "details": {"disease_id": "D04"}}
2025-11-30 22:28:59,227 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:28:59.227284", "details": {"disease_id": "D04", "data_type": "guideline"}}
2025-11-30 22:28:59,227 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:28:59.227284", "details": {}}
2025-11-30 22:28:59,227 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:28:59.227284", "details": {"filename": "guideline.json"}}
2025-11-30 22:28:59,227 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:28:59.227284", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:28:59,229 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:28:59.229283", "details": {"disease_id": "D04", "data_type": "risk"}}
2025-11-30 22:28:59,229 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:28:59.229283", "details": {}}
2025-11-30 22:28:59,230 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:28:59.229283", "details": {"filename": "disease_info.json"}}
2025-11-30 22:28:59,230 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:28:59.230789", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:28:59,231 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:28:59.231793", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:28:59,232 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:28:59.232793", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:28:59,232 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:28:59.232793", "details": {"data_count": 5}}
2025-11-30 22:28:59,233 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:28:59.233297", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:28:59,233 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:28:59.233297", "details": {"disease_id": "D04", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:28:59,233 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:28:59.233297", "details": {"data_count": 5}}
2025-11-30 22:28:59,233 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:28:59.233297", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:28:59,233 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:28:59.233297", "details": {"disease_id": "D04", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:28:59,234 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:28:59.234302", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:28:59,234 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:28:59.234302", "details": {}}
2025-11-30 22:28:59,234 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:28:59.234302", "details": {"matched_disease": "高血压急症风险", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:28:59,235 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:28:59.235302", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:28:59,235 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:28:59.235302", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:28:59,235 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:28:59.235302", "details": {}}
2025-11-30 22:28:59,235 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:28:59.235302", "details": {"has_patient_info": true, "disease_name": "高血压急症风险", "matched_symptoms_count": 1}}
2025-11-30 22:28:59,235 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:28:59.235302", "details": {}}
2025-11-30 22:28:59,236 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:28:59.236302", "details": {"instructions_length": 1264}}
2025-11-30 22:28:59,236 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:28:59.236302", "details": {"prompt_length": 1512, "has_format_instructions": true}}
2025-11-30 22:28:59,236 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:28:59.236302", "prompt_length": 1512, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:28:59,236 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:28:59.236302", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:28:59,236 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:28:59.236302", "details": {"disease_name": "高血压急症风险", "urgency": "高"}}
2025-11-30 22:28:59,236 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:28:59.236302", "details": {"response_length": 325, "has_json_format": true}}
2025-11-30 22:28:59,238 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.002 seconds
2025-11-30 22:28:59,238 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:28:59.238301", "details": {"response_length": 325, "duration": 0.0019989013671875, "model": "deepseek-chat"}}
2025-11-30 22:28:59,238 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:28:59.238301", "prompt_length": 1512, "response_length": 325, "tokens_used": null, "duration_seconds": 0.0019989013671875, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似高血压急症风险\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"**情况紧急**。建议立即由他人陪同前往最近的急诊中心。\",\n               ..."}
2025-11-30 22:28:59,239 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:28:59.239302", "details": {}}
2025-11-30 22:28:59,239 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:28:59.239302", "details": {"output_length": 325, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似高血压急症风险\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"**情况紧急**。建议立即由他人陪同前往最近的急诊中心。\",\n               ..."}}
2025-11-30 22:28:59,239 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:28:59.239302", "details": {}}
2025-11-30 22:28:59,239 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:28:59.239302", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:28:59,239 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:28:59.239302", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:28:59,239 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.000 seconds
2025-11-30 22:28:59,239 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:28:59.239302", "details": {"parsing_time": 0.0, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:28:59,240 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似高血压急症风险...
2025-11-30 22:28:59,240 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:28:59.240807", "metrics": {"total_time": 0.0019989013671875, "llm_time": 0.0019989013671875, "parsing_time": 0.0, "output_length": 325, "model": "deepseek-chat"}}
2025-11-30 22:28:59,240 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:28:59.240807", "details": {"advice_generated": true, "assessment_length": 16}}
2025-11-30 22:28:59,240 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:28:59.240807", "details": {}}
2025-11-30 22:28:59,241 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:28:59.241812", "details": {"status": "success", "disease_name": "高血压急症风险", "has_advice": true}}
2025-11-30 22:28:59,241 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 高血压急症风险 (置信度: 0.9)
2025-11-30 22:28:59,241 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:28:59.241812", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:28:59,242 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:28:59.242811", "data": {"symptom_text": "我发烧了，头很痛", "patient_info": {"age": 30, "gender": "女", "special_conditions": "孕妇"}}, "data_size": 100}
2025-11-30 22:28:59,242 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:28:59.242811", "details": {}}
2025-11-30 22:28:59,242 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:28:59.242811", "details": {"status": "safe"}}
2025-11-30 22:28:59,242 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:28:59.242811", "details": {}}
2025-11-30 22:28:59,242 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:28:59.242811", "details": {"symptom_text": "我发烧了，头很痛"}}
2025-11-30 22:28:59,243 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:28:59.243811", "details": {"extracted_keywords": ["发烧"], "keyword_count": 1}}
2025-11-30 22:28:59,243 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:28:59.243811", "details": {"matched_diseases": ["D01"], "total_matches": 1}}
2025-11-30 22:28:59,243 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:28:59.243811", "details": {"best_disease": "D01", "confidence": 0.8, "matched_symptoms": ["发烧"]}}
2025-11-30 22:28:59,243 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:28:59.243811", "details": {"matched_disease": "普通感冒", "confidence": 0.8}}
2025-11-30 22:28:59,243 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:28:59.243811", "details": {"disease_id": "D01"}}
2025-11-30 22:28:59,244 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:28:59.244812", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:28:59,244 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:28:59.244812", "details": {}}
2025-11-30 22:28:59,244 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:28:59.244812", "details": {"filename": "guideline.json"}}
2025-11-30 22:28:59,244 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:28:59.244812", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:28:59,244 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:28:59.244812", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:28:59,245 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:28:59.245811", "details": {}}
2025-11-30 22:28:59,245 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:28:59.245811", "details": {"filename": "disease_info.json"}}
2025-11-30 22:28:59,245 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:28:59.245811", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:28:59,246 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:28:59.246813", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:28:59,246 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:28:59.246813", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:28:59,247 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:28:59.247813", "details": {"data_count": 5}}
2025-11-30 22:28:59,247 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:28:59.247813", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:28:59,247 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:28:59.247813", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:28:59,248 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:28:59.248811", "details": {"data_count": 5}}
2025-11-30 22:28:59,248 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:28:59.248811", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:28:59,248 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:28:59.248811", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:28:59,248 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:28:59.248811", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:28:59,248 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:28:59.248811", "details": {}}
2025-11-30 22:28:59,248 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:28:59.248811", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:28:59,249 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:28:59.249812", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:28:59,249 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:28:59.249812", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:28:59,249 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:28:59.249812", "details": {}}
2025-11-30 22:28:59,249 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:28:59.249812", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:28:59,249 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:28:59.249812", "details": {}}
2025-11-30 22:28:59,249 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:28:59.249812", "details": {"instructions_length": 1264}}
2025-11-30 22:28:59,250 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:28:59.250811", "details": {"prompt_length": 1499, "has_format_instructions": true}}
2025-11-30 22:28:59,250 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:28:59.250811", "prompt_length": 1499, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:28:59,250 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:28:59.250811", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:28:59,250 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:28:59.250811", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:28:59,250 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:28:59.250811", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:28:59,251 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.001 seconds
2025-11-30 22:28:59,251 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:28:59.251314", "details": {"response_length": 323, "duration": 0.0005030632019042969, "model": "deepseek-chat"}}
2025-11-30 22:28:59,251 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:28:59.251314", "prompt_length": 1499, "response_length": 323, "tokens_used": null, "duration_seconds": 0.0005030632019042969, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}
2025-11-30 22:28:59,252 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:28:59.252320", "details": {}}
2025-11-30 22:28:59,252 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:28:59.252320", "details": {"output_length": 323, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}}
2025-11-30 22:28:59,252 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:28:59.252320", "details": {}}
2025-11-30 22:28:59,252 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:28:59.252320", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:28:59,253 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:28:59.253325", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:28:59,253 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.001 seconds
2025-11-30 22:28:59,253 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:28:59.253325", "details": {"parsing_time": 0.0010046958923339844, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:28:59,253 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似上呼吸道感染（普通感冒）...
2025-11-30 22:28:59,253 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:28:59.253325", "metrics": {"total_time": 0.0015077590942382812, "llm_time": 0.0005030632019042969, "parsing_time": 0.0010046958923339844, "output_length": 323, "model": "deepseek-chat"}}
2025-11-30 22:28:59,253 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:28:59.253325", "details": {"advice_generated": true, "assessment_length": 21}}
2025-11-30 22:28:59,254 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:28:59.254324", "details": {}}
2025-11-30 22:28:59,254 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:28:59.254324", "details": {"status": "success", "disease_name": "普通感冒", "has_advice": true}}
2025-11-30 22:28:59,254 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 普通感冒 (置信度: 0.8)
2025-11-30 22:28:59,255 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:28:59.255325", "details": {"symptom_text_length": 9, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:28:59,255 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:28:59.255325", "data": {"symptom_text": "胸口很痛，呼吸困难", "patient_info": {"age": 55, "gender": "男", "special_conditions": "高血压"}}, "data_size": 102}
2025-11-30 22:28:59,255 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:28:59.255325", "details": {}}
2025-11-30 22:28:59,255 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:28:59.255325", "details": {"status": "safe"}}
2025-11-30 22:28:59,256 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:28:59.256326", "details": {}}
2025-11-30 22:28:59,256 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:28:59.256326", "details": {"symptom_text": "胸口很痛，呼吸困难"}}
2025-11-30 22:28:59,256 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:28:59.256326", "details": {"extracted_keywords": [], "keyword_count": 0}}
2025-11-30 22:28:59,256 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 未提取到任何关键词
2025-11-30 22:28:59,256 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:28:59.256326", "details": {"matched_disease": "普通感冒", "confidence": 0.3}}
2025-11-30 22:28:59,257 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:28:59.257326", "details": {"disease_id": "D01"}}
2025-11-30 22:28:59,257 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:28:59.257326", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:28:59,257 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:28:59.257326", "details": {}}
2025-11-30 22:28:59,257 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:28:59.257326", "details": {"filename": "guideline.json"}}
2025-11-30 22:28:59,258 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:28:59.258325", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:28:59,258 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:28:59.258325", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:28:59,258 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:28:59.258325", "details": {}}
2025-11-30 22:28:59,258 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:28:59.258325", "details": {"filename": "disease_info.json"}}
2025-11-30 22:28:59,259 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:28:59.259326", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:28:59,259 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:28:59.259326", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:28:59,260 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:28:59.260831", "details": {"data_count": 5}}
2025-11-30 22:28:59,260 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:28:59.260831", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:28:59,260 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:28:59.260831", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:28:59,260 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:28:59.260831", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:28:59,261 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:28:59.261836", "details": {"data_count": 5}}
2025-11-30 22:28:59,261 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:28:59.261836", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:28:59,261 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:28:59.261836", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:28:59,262 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:28:59.262835", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:28:59,262 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:28:59.262835", "details": {}}
2025-11-30 22:28:59,262 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:28:59.262835", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:28:59,262 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:28:59.262835", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:28:59,263 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:28:59.262835", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:28:59,263 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:28:59.263836", "details": {}}
2025-11-30 22:28:59,263 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:28:59.263836", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:28:59,263 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:28:59.263836", "details": {}}
2025-11-30 22:28:59,263 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:28:59.263836", "details": {"instructions_length": 1264}}
2025-11-30 22:28:59,263 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:28:59.263836", "details": {"prompt_length": 1502, "has_format_instructions": true}}
2025-11-30 22:28:59,264 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:28:59.264836", "prompt_length": 1502, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:28:59,264 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:28:59.264836", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:28:59,264 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:28:59.264836", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:28:59,264 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:28:59.264836", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:28:59,265 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.001 seconds
2025-11-30 22:28:59,265 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:28:59.265835", "details": {"response_length": 323, "duration": 0.0009989738464355469, "model": "deepseek-chat"}}
2025-11-30 22:28:59,265 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:28:59.265835", "prompt_length": 1502, "response_length": 323, "tokens_used": null, "duration_seconds": 0.0009989738464355469, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}
2025-11-30 22:28:59,265 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:28:59.265835", "details": {}}
2025-11-30 22:28:59,265 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:28:59.265835", "details": {"output_length": 323, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}}
2025-11-30 22:28:59,266 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:28:59.266835", "details": {}}
2025-11-30 22:28:59,266 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:28:59.266835", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:28:59,266 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:28:59.266835", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:28:59,267 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.002 seconds
2025-11-30 22:28:59,267 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:28:59.267836", "details": {"parsing_time": 0.002000570297241211, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:28:59,267 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似上呼吸道感染（普通感冒）...
2025-11-30 22:28:59,267 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:28:59.267836", "metrics": {"total_time": 0.002999544143676758, "llm_time": 0.0009989738464355469, "parsing_time": 0.002000570297241211, "output_length": 323, "model": "deepseek-chat"}}
2025-11-30 22:28:59,267 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:28:59.267836", "details": {"advice_generated": true, "assessment_length": 21}}
2025-11-30 22:28:59,267 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:28:59.267836", "details": {}}
2025-11-30 22:28:59,268 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:28:59.268835", "details": {"status": "success", "disease_name": "普通感冒", "has_advice": true}}
2025-11-30 22:28:59,268 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 普通感冒 (置信度: 0.3)
2025-11-30 22:28:59,269 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:28:59.269838", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:28:59,270 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:28:59.270836", "data": {"symptom_text": "恶心想吐，肚子痛", "patient_info": {"age": 20, "gender": "女", "special_conditions": ""}}, "data_size": 98}
2025-11-30 22:28:59,270 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:28:59.270836", "details": {}}
2025-11-30 22:28:59,270 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:28:59.270836", "details": {"status": "unsafe"}}
2025-11-30 22:28:59,270 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 内容安全检查失败: 输入内容不符合医疗咨询要求
2025-11-30 22:28:59,784 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:28:59.784573", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:28:59,785 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:28:59.785565", "details": {"data_dir_exists": true}}
2025-11-30 22:28:59,785 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:28:59,785 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:28:59.785565", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:28:59,793 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:28:59.793094", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:28:59,794 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:28:59.794095", "details": {"data_dir_exists": true}}
2025-11-30 22:28:59,794 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:28:59,794 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:28:59.794095", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:28:59,829 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:28:59.829771", "details": {}}
2025-11-30 22:28:59,829 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:28:59.829771", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:28:59,831 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:28:59.831953", "details": {}}
2025-11-30 22:28:59,832 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:28:59.831953", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:29:00,304 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:29:00.304235", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:29:00,305 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:29:00.305235", "details": {}}
2025-11-30 22:29:00,306 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:00.306236", "details": {"instructions_length": 1264}}
2025-11-30 22:29:00,307 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:29:00.307235", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:29:00,307 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:29:00,309 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:29:00.309235", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:29:00,309 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:29:00.309235", "details": {}}
2025-11-30 22:29:00,310 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:00.310738", "details": {"instructions_length": 1264}}
2025-11-30 22:29:00,310 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:29:00.310738", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:29:00,311 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:29:12,651 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:29:12.651367", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:29:12,651 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:29:12.651367", "details": {"data_dir_exists": true}}
2025-11-30 22:29:12,651 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:29:12,651 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:29:12.651367", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:29:12,654 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:29:12.654372", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:29:12,654 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:29:12.654372", "details": {"data_dir_exists": true}}
2025-11-30 22:29:12,655 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:29:12,655 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:29:12.655372", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:29:12,685 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:29:12.685468", "details": {}}
2025-11-30 22:29:12,685 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:29:12.685468", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:29:12,688 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:29:12.688467", "details": {}}
2025-11-30 22:29:12,688 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:29:12.688467", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:29:13,171 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:29:13.171631", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:29:13,171 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:29:13.171631", "details": {}}
2025-11-30 22:29:13,175 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:13.174635", "details": {"instructions_length": 1264}}
2025-11-30 22:29:13,175 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:29:13.175637", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:29:13,176 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:29:13,202 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:29:13.202171", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:29:13,202 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:29:13.202791", "details": {}}
2025-11-30 22:29:13,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:13.203796", "details": {"instructions_length": 1264}}
2025-11-30 22:29:13,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:29:13.203796", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:29:13,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:29:20,163 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:29:20.163396", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:29:20,164 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:29:20.163396", "details": {"data_dir_exists": true}}
2025-11-30 22:29:20,164 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:29:20,164 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:29:20.164396", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 250}}
2025-11-30 22:29:20,164 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - Running in test mode - no API key provided, will use mock responses
2025-11-30 22:29:20,164 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "test_mode_enabled", "timestamp": "2025-11-30T22:29:20.164396", "details": {"reason": "no_api_key"}}
2025-11-30 22:29:20,165 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:29:20.165396", "details": {}}
2025-11-30 22:29:20,165 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:29:20.165396", "details": {"model": "deepseek-chat", "has_api_key": false, "has_base_url": false}}
2025-11-30 22:29:20,165 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - API密钥未配置，将使用基础解析器
2025-11-30 22:29:20,165 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:29:20.165396", "details": {}}
2025-11-30 22:29:20,167 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:20.167396", "details": {"instructions_length": 1264}}
2025-11-30 22:29:20,167 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:29:20.167396", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:29:20,167 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:29:20,167 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:29:20.167396", "details": {"symptom_text_length": 7, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:29:20,168 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:29:20.168395", "data": {"symptom_text": "我有点头晕咳嗽", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 97}
2025-11-30 22:29:20,168 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:29:20.168395", "details": {}}
2025-11-30 22:29:20,169 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:29:20.169396", "details": {"status": "safe"}}
2025-11-30 22:29:20,169 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:29:20.169396", "details": {}}
2025-11-30 22:29:20,169 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:29:20.169396", "details": {"symptom_text": "我有点头晕咳嗽"}}
2025-11-30 22:29:20,169 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:29:20.169396", "details": {"extracted_keywords": ["头晕", "咳嗽"], "keyword_count": 2}}
2025-11-30 22:29:20,169 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:29:20.169396", "details": {"matched_diseases": ["D04", "D01"], "total_matches": 2}}
2025-11-30 22:29:20,169 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:29:20.169396", "details": {"best_disease": "D04", "confidence": 0.9, "matched_symptoms": ["头晕"]}}
2025-11-30 22:29:20,169 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:29:20.169396", "details": {"matched_disease": "高血压急症风险", "confidence": 0.9}}
2025-11-30 22:29:20,169 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:29:20.169396", "details": {"disease_id": "D04"}}
2025-11-30 22:29:20,170 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:29:20.170900", "details": {"disease_id": "D04", "data_type": "guideline"}}
2025-11-30 22:29:20,170 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:29:20.170900", "details": {}}
2025-11-30 22:29:20,170 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:29:20.170900", "details": {"filename": "guideline.json"}}
2025-11-30 22:29:20,170 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:29:20.170900", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:29:20,171 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:29:20.171904", "details": {"disease_id": "D04", "data_type": "risk"}}
2025-11-30 22:29:20,172 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:29:20.172904", "details": {}}
2025-11-30 22:29:20,172 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:29:20.172904", "details": {"filename": "disease_info.json"}}
2025-11-30 22:29:20,172 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:29:20.172904", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:29:20,174 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:29:20.174907", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:29:20,175 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:29:20.175242", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:29:20,175 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:29:20.175746", "details": {"data_count": 5}}
2025-11-30 22:29:20,175 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:29:20.175746", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:29:20,175 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:29:20.175746", "details": {"disease_id": "D04", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:29:20,176 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:29:20.176753", "details": {"data_count": 5}}
2025-11-30 22:29:20,176 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:29:20.176753", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:29:20,176 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:29:20.176753", "details": {"disease_id": "D04", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:29:20,176 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:29:20.176753", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:29:20,177 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:29:20.177752", "details": {}}
2025-11-30 22:29:20,177 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:29:20.177752", "details": {"matched_disease": "高血压急症风险", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:29:20,177 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:29:20.177752", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:29:20,177 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:29:20.177752", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:29:20,177 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:29:20.177752", "details": {}}
2025-11-30 22:29:20,178 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:29:20.178751", "details": {"has_patient_info": true, "disease_name": "高血压急症风险", "matched_symptoms_count": 1}}
2025-11-30 22:29:20,178 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:29:20.178751", "details": {}}
2025-11-30 22:29:20,178 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:20.178751", "details": {"instructions_length": 1264}}
2025-11-30 22:29:20,178 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:29:20.178751", "details": {"prompt_length": 1512, "has_format_instructions": true}}
2025-11-30 22:29:20,178 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:29:20.178751", "prompt_length": 1512, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:29:20,178 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:29:20.178751", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:29:20,179 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:29:20.179751", "details": {"disease_name": "高血压急症风险", "urgency": "高"}}
2025-11-30 22:29:20,179 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:29:20.179751", "details": {"response_length": 325, "has_json_format": true}}
2025-11-30 22:29:20,179 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.001 seconds
2025-11-30 22:29:20,179 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:29:20.179751", "details": {"response_length": 325, "duration": 0.0009999275207519531, "model": "deepseek-chat"}}
2025-11-30 22:29:20,179 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:29:20.179751", "prompt_length": 1512, "response_length": 325, "tokens_used": null, "duration_seconds": 0.0009999275207519531, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似高血压急症风险\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"**情况紧急**。建议立即由他人陪同前往最近的急诊中心。\",\n               ..."}
2025-11-30 22:29:20,179 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:29:20.179751", "details": {}}
2025-11-30 22:29:20,179 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:29:20.179751", "details": {"output_length": 325, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似高血压急症风险\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"**情况紧急**。建议立即由他人陪同前往最近的急诊中心。\",\n               ..."}}
2025-11-30 22:29:20,179 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:29:20.179751", "details": {}}
2025-11-30 22:29:20,180 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:29:20.180751", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:29:20,180 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:29:20.180751", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:29:20,180 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.001 seconds
2025-11-30 22:29:20,181 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:29:20.181253", "details": {"parsing_time": 0.0009996891021728516, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:29:20,181 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似高血压急症风险...
2025-11-30 22:29:20,181 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:29:20.181253", "metrics": {"total_time": 0.0019996166229248047, "llm_time": 0.0009999275207519531, "parsing_time": 0.0009996891021728516, "output_length": 325, "model": "deepseek-chat"}}
2025-11-30 22:29:20,181 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:29:20.181253", "details": {"advice_generated": true, "assessment_length": 16}}
2025-11-30 22:29:20,181 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:29:20.181253", "details": {}}
2025-11-30 22:29:20,182 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:29:20.182257", "details": {"status": "success", "disease_name": "高血压急症风险", "has_advice": true}}
2025-11-30 22:29:20,182 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 高血压急症风险 (置信度: 0.9)
2025-11-30 22:29:20,183 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:29:20.183261", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:29:20,183 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:29:20.183261", "data": {"symptom_text": "我发烧了，头很痛", "patient_info": {"age": 30, "gender": "女", "special_conditions": "孕妇"}}, "data_size": 100}
2025-11-30 22:29:20,183 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:29:20.183261", "details": {}}
2025-11-30 22:29:20,184 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:29:20.184260", "details": {"status": "safe"}}
2025-11-30 22:29:20,184 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:29:20.184260", "details": {}}
2025-11-30 22:29:20,184 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:29:20.184260", "details": {"symptom_text": "我发烧了，头很痛"}}
2025-11-30 22:29:20,185 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:29:20.185260", "details": {"extracted_keywords": ["发烧"], "keyword_count": 1}}
2025-11-30 22:29:20,185 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:29:20.185260", "details": {"matched_diseases": ["D01"], "total_matches": 1}}
2025-11-30 22:29:20,185 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:29:20.185260", "details": {"best_disease": "D01", "confidence": 0.8, "matched_symptoms": ["发烧"]}}
2025-11-30 22:29:20,186 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:29:20.186260", "details": {"matched_disease": "普通感冒", "confidence": 0.8}}
2025-11-30 22:29:20,186 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:29:20.186260", "details": {"disease_id": "D01"}}
2025-11-30 22:29:20,186 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:29:20.186260", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:29:20,186 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:29:20.186260", "details": {}}
2025-11-30 22:29:20,187 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:29:20.187261", "details": {"filename": "guideline.json"}}
2025-11-30 22:29:20,187 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:29:20.187261", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:29:20,188 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:29:20.188261", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:29:20,188 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:29:20.188261", "details": {}}
2025-11-30 22:29:20,188 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:29:20.188261", "details": {"filename": "disease_info.json"}}
2025-11-30 22:29:20,188 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:29:20.188261", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:29:20,189 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:29:20.189262", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:29:20,189 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:29:20.189262", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:29:20,189 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:29:20.189262", "details": {"data_count": 5}}
2025-11-30 22:29:20,190 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:29:20.190769", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:29:20,190 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:29:20.190769", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:29:20,190 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:29:20.190769", "details": {"data_count": 5}}
2025-11-30 22:29:20,191 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:29:20.191775", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:29:20,191 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:29:20.191775", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:29:20,191 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:29:20.191775", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:29:20,191 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:29:20.191775", "details": {}}
2025-11-30 22:29:20,191 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:29:20.191775", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:29:20,192 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:29:20.192775", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:29:20,192 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:29:20.192775", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:29:20,192 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:29:20.192775", "details": {}}
2025-11-30 22:29:20,192 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:29:20.192775", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:29:20,193 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:29:20.193775", "details": {}}
2025-11-30 22:29:20,193 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:20.193775", "details": {"instructions_length": 1264}}
2025-11-30 22:29:20,193 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:29:20.193775", "details": {"prompt_length": 1499, "has_format_instructions": true}}
2025-11-30 22:29:20,193 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:29:20.193775", "prompt_length": 1499, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:29:20,193 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:29:20.193775", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:29:20,194 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:29:20.194776", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:29:20,194 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:29:20.194776", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:29:20,194 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.001 seconds
2025-11-30 22:29:20,194 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:29:20.194776", "details": {"response_length": 323, "duration": 0.001001119613647461, "model": "deepseek-chat"}}
2025-11-30 22:29:20,194 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:29:20.194776", "prompt_length": 1499, "response_length": 323, "tokens_used": null, "duration_seconds": 0.001001119613647461, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}
2025-11-30 22:29:20,194 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:29:20.194776", "details": {}}
2025-11-30 22:29:20,195 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:29:20.195776", "details": {"output_length": 323, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}}
2025-11-30 22:29:20,195 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:29:20.195776", "details": {}}
2025-11-30 22:29:20,195 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:29:20.195776", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:29:20,195 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:29:20.195776", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:29:20,195 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.000 seconds
2025-11-30 22:29:20,195 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:29:20.195776", "details": {"parsing_time": 0.0, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:29:20,195 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似上呼吸道感染（普通感冒）...
2025-11-30 22:29:20,195 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:29:20.195776", "metrics": {"total_time": 0.001001119613647461, "llm_time": 0.001001119613647461, "parsing_time": 0.0, "output_length": 323, "model": "deepseek-chat"}}
2025-11-30 22:29:20,196 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:29:20.196775", "details": {"advice_generated": true, "assessment_length": 21}}
2025-11-30 22:29:20,196 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:29:20.196775", "details": {}}
2025-11-30 22:29:20,196 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:29:20.196775", "details": {"status": "success", "disease_name": "普通感冒", "has_advice": true}}
2025-11-30 22:29:20,196 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 普通感冒 (置信度: 0.8)
2025-11-30 22:29:20,197 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:29:20.197776", "details": {"symptom_text_length": 9, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:29:20,197 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:29:20.197776", "data": {"symptom_text": "胸口很痛，呼吸困难", "patient_info": {"age": 55, "gender": "男", "special_conditions": "高血压"}}, "data_size": 102}
2025-11-30 22:29:20,197 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:29:20.197776", "details": {}}
2025-11-30 22:29:20,198 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:29:20.198775", "details": {"status": "safe"}}
2025-11-30 22:29:20,198 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:29:20.198775", "details": {}}
2025-11-30 22:29:20,198 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:29:20.198775", "details": {"symptom_text": "胸口很痛，呼吸困难"}}
2025-11-30 22:29:20,198 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:29:20.198775", "details": {"extracted_keywords": [], "keyword_count": 0}}
2025-11-30 22:29:20,198 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 未提取到任何关键词
2025-11-30 22:29:20,199 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:29:20.199775", "details": {"matched_disease": "普通感冒", "confidence": 0.3}}
2025-11-30 22:29:20,199 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:29:20.199775", "details": {"disease_id": "D01"}}
2025-11-30 22:29:20,199 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:29:20.199775", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:29:20,199 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:29:20.199775", "details": {}}
2025-11-30 22:29:20,199 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:29:20.199775", "details": {"filename": "guideline.json"}}
2025-11-30 22:29:20,200 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:29:20.200775", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:29:20,200 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:29:20.200775", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:29:20,200 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:29:20.200775", "details": {}}
2025-11-30 22:29:20,200 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:29:20.200775", "details": {"filename": "disease_info.json"}}
2025-11-30 22:29:20,201 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:29:20.201803", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:29:20,202 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:29:20.202803", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:29:20,202 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:29:20.202803", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:29:20,202 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:29:20.202803", "details": {"data_count": 5}}
2025-11-30 22:29:20,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:29:20.203803", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:29:20,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:29:20.203803", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:29:20,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:29:20.203803", "details": {"data_count": 5}}
2025-11-30 22:29:20,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:29:20.203803", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:29:20,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:29:20.203803", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:29:20,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:29:20.203803", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:29:20,203 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:29:20.203803", "details": {}}
2025-11-30 22:29:20,204 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:29:20.204802", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:29:20,204 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:29:20.204802", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:29:20,204 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:29:20.204802", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:29:20,204 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:29:20.204802", "details": {}}
2025-11-30 22:29:20,205 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:29:20.204802", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:29:20,205 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:29:20.205802", "details": {}}
2025-11-30 22:29:20,205 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:20.205802", "details": {"instructions_length": 1264}}
2025-11-30 22:29:20,205 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:29:20.205802", "details": {"prompt_length": 1502, "has_format_instructions": true}}
2025-11-30 22:29:20,205 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:29:20.205802", "prompt_length": 1502, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:29:20,205 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:29:20.205802", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:29:20,205 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:29:20.205802", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:29:20,205 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:29:20.205802", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:29:20,206 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.001 seconds
2025-11-30 22:29:20,206 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:29:20.206801", "details": {"response_length": 323, "duration": 0.00099945068359375, "model": "deepseek-chat"}}
2025-11-30 22:29:20,206 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:29:20.206801", "prompt_length": 1502, "response_length": 323, "tokens_used": null, "duration_seconds": 0.00099945068359375, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}
2025-11-30 22:29:20,206 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:29:20.206801", "details": {}}
2025-11-30 22:29:20,207 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:29:20.207802", "details": {"output_length": 323, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}}
2025-11-30 22:29:20,207 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:29:20.207802", "details": {}}
2025-11-30 22:29:20,208 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:29:20.208802", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:29:20,208 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:29:20.208802", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:29:20,208 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.001 seconds
2025-11-30 22:29:20,208 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:29:20.208802", "details": {"parsing_time": 0.0010001659393310547, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:29:20,209 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似上呼吸道感染（普通感冒）...
2025-11-30 22:29:20,209 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:29:20.209803", "metrics": {"total_time": 0.0019996166229248047, "llm_time": 0.00099945068359375, "parsing_time": 0.0010001659393310547, "output_length": 323, "model": "deepseek-chat"}}
2025-11-30 22:29:20,209 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:29:20.209803", "details": {"advice_generated": true, "assessment_length": 21}}
2025-11-30 22:29:20,210 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:29:20.210802", "details": {}}
2025-11-30 22:29:20,210 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:29:20.210802", "details": {"status": "success", "disease_name": "普通感冒", "has_advice": true}}
2025-11-30 22:29:20,210 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 普通感冒 (置信度: 0.3)
2025-11-30 22:29:20,212 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:29:20.212919", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:29:20,212 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:29:20.212919", "data": {"symptom_text": "恶心想吐，肚子痛", "patient_info": {"age": 20, "gender": "女", "special_conditions": ""}}, "data_size": 98}
2025-11-30 22:29:20,213 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:29:20.213925", "details": {}}
2025-11-30 22:29:20,213 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:29:20.213925", "details": {"status": "unsafe"}}
2025-11-30 22:29:20,213 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 内容安全检查失败: 输入内容不符合医疗咨询要求
2025-11-30 22:29:49,862 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:29:49.862473", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:29:49,862 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:29:49.862473", "details": {"data_dir_exists": true}}
2025-11-30 22:29:49,862 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:29:49,863 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:29:49.863471", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:29:49,868 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:29:49.868481", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:29:49,868 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:29:49.868481", "details": {"data_dir_exists": true}}
2025-11-30 22:29:49,868 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:29:49,869 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:29:49.869472", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:29:49,896 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:29:49.896875", "details": {}}
2025-11-30 22:29:49,897 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:29:49.897871", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:29:49,905 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:29:49.904378", "details": {}}
2025-11-30 22:29:49,905 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:29:49.905378", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:29:50,533 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:29:50.533727", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:29:50,534 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:29:50.534724", "details": {}}
2025-11-30 22:29:50,535 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:50.535888", "details": {"instructions_length": 1264}}
2025-11-30 22:29:50,536 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:29:50.536608", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:29:50,536 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:29:50,542 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:29:50.542004", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:29:50,542 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:29:50.542546", "details": {}}
2025-11-30 22:29:50,544 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:29:50.544184", "details": {"instructions_length": 1264}}
2025-11-30 22:29:50,544 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:29:50.544709", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:29:50,544 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:30:07,544 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:30:07.544733", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:30:07,544 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:30:07.544733", "details": {"data_dir_exists": true}}
2025-11-30 22:30:07,544 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:30:07,544 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:30:07.544733", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:30:07,560 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:30:07.560736", "details": {}}
2025-11-30 22:30:07,560 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:30:07.560736", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:30:07,967 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:30:07.967072", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:30:07,967 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:30:07.967072", "details": {}}
2025-11-30 22:30:07,969 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:30:07.969075", "details": {"instructions_length": 1264}}
2025-11-30 22:30:07,969 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:30:07.969075", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:30:07,969 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:30:10,426 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:30:10.426047", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:30:10,427 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:30:10.427046", "details": {"data_dir_exists": true}}
2025-11-30 22:30:10,427 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:30:10,427 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:30:10.427046", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:30:10,459 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:30:10.459084", "details": {}}
2025-11-30 22:30:10,460 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:30:10.460083", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:30:10,929 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:30:10.929637", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:30:10,929 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:30:10.929637", "details": {}}
2025-11-30 22:30:10,931 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:30:10.931142", "details": {"instructions_length": 1264}}
2025-11-30 22:30:10,931 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:30:10.931142", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:30:10,931 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:30:12,375 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:30:12.375822", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:30:12,375 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:30:12.375822", "details": {"data_dir_exists": true}}
2025-11-30 22:30:12,376 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:30:12,376 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:30:12.376818", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 250}}
2025-11-30 22:30:12,376 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - Running in test mode - no API key provided, will use mock responses
2025-11-30 22:30:12,376 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "test_mode_enabled", "timestamp": "2025-11-30T22:30:12.376818", "details": {"reason": "no_api_key"}}
2025-11-30 22:30:12,376 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:30:12.376818", "details": {}}
2025-11-30 22:30:12,376 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:30:12.376818", "details": {"model": "deepseek-chat", "has_api_key": false, "has_base_url": false}}
2025-11-30 22:30:12,376 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - API密钥未配置，将使用基础解析器
2025-11-30 22:30:12,376 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:30:12.376818", "details": {}}
2025-11-30 22:30:12,377 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:30:12.377819", "details": {"instructions_length": 1264}}
2025-11-30 22:30:12,377 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:30:12.377819", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:30:12,377 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:30:12,378 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:30:12.378818", "details": {"symptom_text_length": 7, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:30:12,378 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:30:12.378818", "data": {"symptom_text": "我有点头晕咳嗽", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 97}
2025-11-30 22:30:12,378 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:30:12.378818", "details": {}}
2025-11-30 22:30:12,378 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:30:12.378818", "details": {"status": "safe"}}
2025-11-30 22:30:12,378 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:30:12.378818", "details": {}}
2025-11-30 22:30:12,379 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:30:12.379819", "details": {"symptom_text": "我有点头晕咳嗽"}}
2025-11-30 22:30:12,379 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:30:12.379819", "details": {"extracted_keywords": ["头晕", "咳嗽"], "keyword_count": 2}}
2025-11-30 22:30:12,379 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:30:12.379819", "details": {"matched_diseases": ["D04", "D01"], "total_matches": 2}}
2025-11-30 22:30:12,379 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:30:12.379819", "details": {"best_disease": "D04", "confidence": 0.9, "matched_symptoms": ["头晕"]}}
2025-11-30 22:30:12,379 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:30:12.379819", "details": {"matched_disease": "高血压急症风险", "confidence": 0.9}}
2025-11-30 22:30:12,379 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:30:12.379819", "details": {"disease_id": "D04"}}
2025-11-30 22:30:12,379 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:30:12.379819", "details": {"disease_id": "D04", "data_type": "guideline"}}
2025-11-30 22:30:12,380 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:30:12.379819", "details": {}}
2025-11-30 22:30:12,380 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:30:12.380819", "details": {"filename": "guideline.json"}}
2025-11-30 22:30:12,380 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:30:12.380819", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:30:12,381 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:30:12.381835", "details": {"disease_id": "D04", "data_type": "risk"}}
2025-11-30 22:30:12,381 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:30:12.381835", "details": {}}
2025-11-30 22:30:12,381 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:30:12.381835", "details": {"filename": "disease_info.json"}}
2025-11-30 22:30:12,381 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:30:12.381835", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:30:12,382 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:30:12.382835", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:30:12,382 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:30:12.382835", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:30:12,383 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:30:12.382835", "details": {"data_count": 5}}
2025-11-30 22:30:12,383 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:30:12.383834", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:30:12,383 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:30:12.383834", "details": {"disease_id": "D04", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:30:12,383 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:30:12.383834", "details": {"data_count": 5}}
2025-11-30 22:30:12,383 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:30:12.383834", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:30:12,383 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:30:12.383834", "details": {"disease_id": "D04", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:30:12,383 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:30:12.383834", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:30:12,383 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:30:12.383834", "details": {}}
2025-11-30 22:30:12,383 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:30:12.383834", "details": {"matched_disease": "高血压急症风险", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:30:12,384 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:30:12.384834", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:30:12,384 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:30:12.384834", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:30:12,384 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.384834", "details": {}}
2025-11-30 22:30:12,384 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.384834", "details": {"has_patient_info": true, "disease_name": "高血压急症风险", "matched_symptoms_count": 1}}
2025-11-30 22:30:12,384 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:30:12.384834", "details": {}}
2025-11-30 22:30:12,384 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:30:12.384834", "details": {"instructions_length": 1264}}
2025-11-30 22:30:12,384 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:30:12.384834", "details": {"prompt_length": 1512, "has_format_instructions": true}}
2025-11-30 22:30:12,385 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:30:12.385834", "prompt_length": 1512, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:30:12,385 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:30:12.385834", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:30:12,385 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:30:12.385834", "details": {"disease_name": "高血压急症风险", "urgency": "高"}}
2025-11-30 22:30:12,385 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:30:12.385834", "details": {"response_length": 325, "has_json_format": true}}
2025-11-30 22:30:12,385 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.000 seconds
2025-11-30 22:30:12,385 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:30:12.385834", "details": {"response_length": 325, "duration": 0.0, "model": "deepseek-chat"}}
2025-11-30 22:30:12,385 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:30:12.385834", "prompt_length": 1512, "response_length": 325, "tokens_used": null, "duration_seconds": 0.0, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似高血压急症风险\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"**情况紧急**。建议立即由他人陪同前往最近的急诊中心。\",\n               ..."}
2025-11-30 22:30:12,386 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:30:12.386834", "details": {}}
2025-11-30 22:30:12,386 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.386834", "details": {"output_length": 325, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似高血压急症风险\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"**情况紧急**。建议立即由他人陪同前往最近的急诊中心。\",\n               ..."}}
2025-11-30 22:30:12,386 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:30:12.386834", "details": {}}
2025-11-30 22:30:12,386 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:30:12.386834", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:30:12,386 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:30:12.386834", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:30:12,386 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.000 seconds
2025-11-30 22:30:12,386 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:30:12.386834", "details": {"parsing_time": 0.0, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:30:12,386 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似高血压急症风险...
2025-11-30 22:30:12,387 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:30:12.387834", "metrics": {"total_time": 0.0, "llm_time": 0.0, "parsing_time": 0.0, "output_length": 325, "model": "deepseek-chat"}}
2025-11-30 22:30:12,387 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:30:12.387834", "details": {"advice_generated": true, "assessment_length": 16}}
2025-11-30 22:30:12,387 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:30:12.387834", "details": {}}
2025-11-30 22:30:12,387 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:30:12.387834", "details": {"status": "success", "disease_name": "高血压急症风险", "has_advice": true}}
2025-11-30 22:30:12,387 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 高血压急症风险 (置信度: 0.9)
2025-11-30 22:30:12,388 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:30:12.388834", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:30:12,388 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:30:12.388834", "data": {"symptom_text": "我发烧了，头很痛", "patient_info": {"age": 30, "gender": "女", "special_conditions": "孕妇"}}, "data_size": 100}
2025-11-30 22:30:12,388 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:30:12.388834", "details": {}}
2025-11-30 22:30:12,388 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:30:12.388834", "details": {"status": "safe"}}
2025-11-30 22:30:12,388 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:30:12.388834", "details": {}}
2025-11-30 22:30:12,388 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:30:12.388834", "details": {"symptom_text": "我发烧了，头很痛"}}
2025-11-30 22:30:12,389 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:30:12.389834", "details": {"extracted_keywords": ["发烧"], "keyword_count": 1}}
2025-11-30 22:30:12,389 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:30:12.389834", "details": {"matched_diseases": ["D01"], "total_matches": 1}}
2025-11-30 22:30:12,389 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:30:12.389834", "details": {"best_disease": "D01", "confidence": 0.8, "matched_symptoms": ["发烧"]}}
2025-11-30 22:30:12,389 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:30:12.389834", "details": {"matched_disease": "普通感冒", "confidence": 0.8}}
2025-11-30 22:30:12,389 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:30:12.389834", "details": {"disease_id": "D01"}}
2025-11-30 22:30:12,389 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:30:12.389834", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:30:12,390 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:30:12.390834", "details": {}}
2025-11-30 22:30:12,390 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:30:12.390834", "details": {"filename": "guideline.json"}}
2025-11-30 22:30:12,390 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:30:12.390834", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:30:12,390 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:30:12.390834", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:30:12,390 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:30:12.390834", "details": {}}
2025-11-30 22:30:12,390 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:30:12.390834", "details": {"filename": "disease_info.json"}}
2025-11-30 22:30:12,391 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:30:12.390834", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:30:12,391 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:30:12.391879", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:30:12,391 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:30:12.391879", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:30:12,392 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:30:12.391879", "details": {"data_count": 5}}
2025-11-30 22:30:12,392 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:30:12.392879", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:30:12,392 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:30:12.392879", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:30:12,392 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:30:12.392879", "details": {"data_count": 5}}
2025-11-30 22:30:12,392 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:30:12.392879", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:30:12,392 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:30:12.392879", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:30:12,392 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:30:12.392879", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:30:12,392 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:30:12.392879", "details": {}}
2025-11-30 22:30:12,392 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:30:12.392879", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:30:12,393 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:30:12.393879", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:30:12,393 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:30:12.393879", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:30:12,393 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.393879", "details": {}}
2025-11-30 22:30:12,393 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.393879", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:30:12,393 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:30:12.393879", "details": {}}
2025-11-30 22:30:12,393 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:30:12.393879", "details": {"instructions_length": 1264}}
2025-11-30 22:30:12,393 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:30:12.393879", "details": {"prompt_length": 1499, "has_format_instructions": true}}
2025-11-30 22:30:12,393 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:30:12.393879", "prompt_length": 1499, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:30:12,394 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:30:12.394879", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:30:12,394 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:30:12.394879", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:30:12,394 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:30:12.394879", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:30:12,394 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.000 seconds
2025-11-30 22:30:12,394 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:30:12.394879", "details": {"response_length": 323, "duration": 0.0, "model": "deepseek-chat"}}
2025-11-30 22:30:12,394 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:30:12.394879", "prompt_length": 1499, "response_length": 323, "tokens_used": null, "duration_seconds": 0.0, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}
2025-11-30 22:30:12,394 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:30:12.394879", "details": {}}
2025-11-30 22:30:12,394 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.394879", "details": {"output_length": 323, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}}
2025-11-30 22:30:12,394 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:30:12.394879", "details": {}}
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:30:12.395879", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:30:12.395879", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.001 seconds
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:30:12.395879", "details": {"parsing_time": 0.0009996891021728516, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似上呼吸道感染（普通感冒）...
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:30:12.395879", "metrics": {"total_time": 0.0009996891021728516, "llm_time": 0.0, "parsing_time": 0.0009996891021728516, "output_length": 323, "model": "deepseek-chat"}}
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:30:12.395879", "details": {"advice_generated": true, "assessment_length": 21}}
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:30:12.395879", "details": {}}
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:30:12.395879", "details": {"status": "success", "disease_name": "普通感冒", "has_advice": true}}
2025-11-30 22:30:12,395 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 普通感冒 (置信度: 0.8)
2025-11-30 22:30:12,397 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:30:12.397881", "details": {"symptom_text_length": 9, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:30:12,397 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:30:12.397881", "data": {"symptom_text": "胸口很痛，呼吸困难", "patient_info": {"age": 55, "gender": "男", "special_conditions": "高血压"}}, "data_size": 102}
2025-11-30 22:30:12,398 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:30:12.397881", "details": {}}
2025-11-30 22:30:12,398 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:30:12.398879", "details": {"status": "safe"}}
2025-11-30 22:30:12,398 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:30:12.398879", "details": {}}
2025-11-30 22:30:12,398 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:30:12.398879", "details": {"symptom_text": "胸口很痛，呼吸困难"}}
2025-11-30 22:30:12,398 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:30:12.398879", "details": {"extracted_keywords": [], "keyword_count": 0}}
2025-11-30 22:30:12,399 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 未提取到任何关键词
2025-11-30 22:30:12,399 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:30:12.399880", "details": {"matched_disease": "普通感冒", "confidence": 0.3}}
2025-11-30 22:30:12,399 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:30:12.399880", "details": {"disease_id": "D01"}}
2025-11-30 22:30:12,399 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:30:12.399880", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:30:12,400 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:30:12.400879", "details": {}}
2025-11-30 22:30:12,400 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:30:12.400879", "details": {"filename": "guideline.json"}}
2025-11-30 22:30:12,400 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:30:12.400879", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:30:12,400 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:30:12.400879", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:30:12,400 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:30:12.400879", "details": {}}
2025-11-30 22:30:12,401 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:30:12.401917", "details": {"filename": "disease_info.json"}}
2025-11-30 22:30:12,401 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:30:12.401917", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:30:12,402 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:30:12.402489", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:30:12,402 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:30:12.402993", "details": {"data_count": 5}}
2025-11-30 22:30:12,402 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:30:12.402993", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:30:12,402 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:30:12.402993", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:30:12,403 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:30:12.403999", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:30:12,403 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:30:12.403999", "details": {"data_count": 5}}
2025-11-30 22:30:12,403 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:30:12.403999", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:30:12,403 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:30:12.403999", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:30:12,403 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:30:12.403999", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:30:12,404 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:30:12.404998", "details": {}}
2025-11-30 22:30:12,404 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:30:12.404998", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:30:12,404 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:30:12.404998", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:30:12,404 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:30:12.404998", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:30:12,404 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.404998", "details": {}}
2025-11-30 22:30:12,404 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.404998", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:30:12,405 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:30:12.405999", "details": {}}
2025-11-30 22:30:12,405 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:30:12.405999", "details": {"instructions_length": 1264}}
2025-11-30 22:30:12,405 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:30:12.405999", "details": {"prompt_length": 1502, "has_format_instructions": true}}
2025-11-30 22:30:12,405 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:30:12.405999", "prompt_length": 1502, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:30:12,405 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:30:12.405999", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:30:12,405 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:30:12.405999", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:30:12,405 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:30:12.405999", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:30:12,406 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.000 seconds
2025-11-30 22:30:12,406 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:30:12.406999", "details": {"response_length": 323, "duration": 0.0, "model": "deepseek-chat"}}
2025-11-30 22:30:12,406 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:30:12.406999", "prompt_length": 1502, "response_length": 323, "tokens_used": null, "duration_seconds": 0.0, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}
2025-11-30 22:30:12,406 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:30:12.406999", "details": {}}
2025-11-30 22:30:12,406 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.406999", "details": {"output_length": 323, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}}
2025-11-30 22:30:12,406 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:30:12.406999", "details": {}}
2025-11-30 22:30:12,406 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:30:12.406999", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:30:12,406 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:30:12.406999", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:30:12,406 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.000 seconds
2025-11-30 22:30:12,407 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:30:12.407998", "details": {"parsing_time": 0.0, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:30:12,407 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似上呼吸道感染（普通感冒）...
2025-11-30 22:30:12,407 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:30:12.407998", "metrics": {"total_time": 0.0, "llm_time": 0.0, "parsing_time": 0.0, "output_length": 323, "model": "deepseek-chat"}}
2025-11-30 22:30:12,407 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:30:12.407998", "details": {"advice_generated": true, "assessment_length": 21}}
2025-11-30 22:30:12,407 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:30:12.407998", "details": {}}
2025-11-30 22:30:12,407 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:30:12.407998", "details": {"status": "success", "disease_name": "普通感冒", "has_advice": true}}
2025-11-30 22:30:12,408 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 普通感冒 (置信度: 0.3)
2025-11-30 22:30:12,408 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:30:12.408998", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:30:12,408 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:30:12.408998", "data": {"symptom_text": "恶心想吐，肚子痛", "patient_info": {"age": 20, "gender": "女", "special_conditions": ""}}, "data_size": 98}
2025-11-30 22:30:12,408 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:30:12.408998", "details": {}}
2025-11-30 22:30:12,408 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:30:12.408998", "details": {"status": "safe"}}
2025-11-30 22:30:12,408 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:30:12.408998", "details": {}}
2025-11-30 22:30:12,409 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:30:12.409998", "details": {"symptom_text": "恶心想吐，肚子痛"}}
2025-11-30 22:30:12,409 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:30:12.409998", "details": {"extracted_keywords": ["恶心"], "keyword_count": 1}}
2025-11-30 22:30:12,409 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:30:12.409998", "details": {"matched_diseases": ["D03"], "total_matches": 1}}
2025-11-30 22:30:12,409 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:30:12.409998", "details": {"best_disease": "D03", "confidence": 0.85, "matched_symptoms": ["恶心"]}}
2025-11-30 22:30:12,409 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:30:12.409998", "details": {"matched_disease": "急性肠胃炎", "confidence": 0.85}}
2025-11-30 22:30:12,409 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:30:12.409998", "details": {"disease_id": "D03"}}
2025-11-30 22:30:12,409 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:30:12.409998", "details": {"disease_id": "D03", "data_type": "guideline"}}
2025-11-30 22:30:12,409 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:30:12.409998", "details": {}}
2025-11-30 22:30:12,410 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:30:12.410998", "details": {"filename": "guideline.json"}}
2025-11-30 22:30:12,410 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:30:12.410998", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:30:12,410 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:30:12.410998", "details": {"disease_id": "D03", "data_type": "risk"}}
2025-11-30 22:30:12,410 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:30:12.410998", "details": {}}
2025-11-30 22:30:12,412 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:30:12.412023", "details": {"filename": "disease_info.json"}}
2025-11-30 22:30:12,412 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:30:12.412023", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:30:12,412 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:30:12.412023", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:30:12,413 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:30:12.413024", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:30:12,413 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:30:12.413024", "details": {"data_count": 5}}
2025-11-30 22:30:12,413 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:30:12.413024", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:30:12,413 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:30:12.413024", "details": {"disease_id": "D03", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:30:12,413 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:30:12.413024", "details": {"data_count": 5}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:30:12.414022", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:30:12.414022", "details": {"disease_id": "D03", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:30:12.414022", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:30:12.414022", "details": {}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:30:12.414022", "details": {"matched_disease": "急性肠胃炎", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:30:12.414022", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:30:12.414022", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.414022", "details": {}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.414022", "details": {"has_patient_info": true, "disease_name": "急性肠胃炎", "matched_symptoms_count": 1}}
2025-11-30 22:30:12,414 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:30:12.414022", "details": {}}
2025-11-30 22:30:12,415 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:30:12.415022", "details": {"instructions_length": 1264}}
2025-11-30 22:30:12,415 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:30:12.415022", "details": {"prompt_length": 1514, "has_format_instructions": true}}
2025-11-30 22:30:12,415 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:30:12.415022", "prompt_length": 1514, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:30:12,415 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:30:12.415022", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:30:12,415 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:30:12.415022", "details": {"disease_name": "急性肠胃炎", "urgency": "中"}}
2025-11-30 22:30:12,415 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:30:12.415022", "details": {"response_length": 324, "has_json_format": true}}
2025-11-30 22:30:12,415 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.000 seconds
2025-11-30 22:30:12,416 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:30:12.416024", "details": {"response_length": 324, "duration": 0.0, "model": "deepseek-chat"}}
2025-11-30 22:30:12,416 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:30:12.416024", "prompt_length": 1514, "response_length": 324, "tokens_used": null, "duration_seconds": 0.0, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似急性肠胃炎\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"建议清淡饮食，补充电解质水。若症状频繁或加重，请立即就医。\",\n                ..."}
2025-11-30 22:30:12,416 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:30:12.416024", "details": {}}
2025-11-30 22:30:12,416 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:30:12.416024", "details": {"output_length": 324, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似急性肠胃炎\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"建议清淡饮食，补充电解质水。若症状频繁或加重，请立即就医。\",\n                ..."}}
2025-11-30 22:30:12,416 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:30:12.416024", "details": {}}
2025-11-30 22:30:12,416 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:30:12.416024", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:30:12,416 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:30:12.416024", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:30:12,416 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.000 seconds
2025-11-30 22:30:12,416 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:30:12.416024", "details": {"parsing_time": 0.0, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:30:12,417 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似急性肠胃炎...
2025-11-30 22:30:12,417 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:30:12.417023", "metrics": {"total_time": 0.0, "llm_time": 0.0, "parsing_time": 0.0, "output_length": 324, "model": "deepseek-chat"}}
2025-11-30 22:30:12,417 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:30:12.417023", "details": {"advice_generated": true, "assessment_length": 14}}
2025-11-30 22:30:12,417 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:30:12.417023", "details": {}}
2025-11-30 22:30:12,417 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:30:12.417023", "details": {"status": "success", "disease_name": "急性肠胃炎", "has_advice": true}}
2025-11-30 22:30:12,417 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 急性肠胃炎 (置信度: 0.85)
2025-11-30 22:31:34,535 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:31:34.535584", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:31:34,536 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:31:34.536584", "details": {"data_dir_exists": true}}
2025-11-30 22:31:34,536 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:31:34,537 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:31:34.537585", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:31:34,569 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:31:34.569334", "details": {}}
2025-11-30 22:31:34,569 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:31:34.569334", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:31:35,134 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:31:35.134075", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:31:35,135 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:31:35.135069", "details": {}}
2025-11-30 22:31:35,137 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:31:35.137070", "details": {"instructions_length": 1264}}
2025-11-30 22:31:35,138 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:31:35.138074", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:31:35,138 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:31:37,933 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:31:37.933235", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:31:37,934 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:31:37.933235", "details": {"data_dir_exists": true}}
2025-11-30 22:31:37,934 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:31:37,934 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:31:37.934238", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:31:37,977 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:31:37.977279", "details": {}}
2025-11-30 22:31:37,978 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:31:37.978280", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:31:38,303 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:31:38.303074", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:31:38,303 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:31:38.303074", "details": {"data_dir_exists": true}}
2025-11-30 22:31:38,303 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:31:38,304 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:31:38.304073", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:31:38,331 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:31:38.331613", "details": {}}
2025-11-30 22:31:38,331 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:31:38.331613", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:31:38,349 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:31:38.349529", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:31:38,349 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:31:38.349529", "details": {"data_dir_exists": true}}
2025-11-30 22:31:38,349 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:31:38,351 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:31:38.349529", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:31:38,366 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:31:38.366560", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:31:38,367 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:31:38.367560", "details": {"data_dir_exists": true}}
2025-11-30 22:31:38,367 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:31:38,367 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:31:38.367560", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:31:38,379 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:31:38.379064", "details": {}}
2025-11-30 22:31:38,379 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:31:38.379064", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:31:38,404 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:31:38.404616", "details": {}}
2025-11-30 22:31:38,405 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:31:38.405616", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:31:38,485 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:31:38.485918", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:31:38,485 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:31:38.485918", "details": {}}
2025-11-30 22:31:38,487 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:31:38.487918", "details": {"instructions_length": 1264}}
2025-11-30 22:31:38,488 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:31:38.488917", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:31:38,488 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:31:38,889 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:31:38.889307", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:31:38,889 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:31:38.889307", "details": {}}
2025-11-30 22:31:38,891 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:31:38.891813", "details": {"instructions_length": 1264}}
2025-11-30 22:31:38,891 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:31:38.891813", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:31:38,892 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:31:39,021 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:31:39.021967", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:31:39,022 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:31:39.022966", "details": {}}
2025-11-30 22:31:39,025 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:31:39.025966", "details": {"instructions_length": 1264}}
2025-11-30 22:31:39,026 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:31:39.026967", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:31:39,026 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:31:39,101 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:31:39.101986", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:31:39,101 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:31:39.101986", "details": {}}
2025-11-30 22:31:39,105 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:31:39.105558", "details": {"instructions_length": 1264}}
2025-11-30 22:31:39,105 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:31:39.105558", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:31:39,106 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:32:06,920 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:32:06.920875", "details": {"symptom_text_length": 4, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:32:06,920 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:32:06.920875", "data": {"symptom_text": "头很晕呢", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 94}
2025-11-30 22:32:06,921 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:32:06.921885", "details": {}}
2025-11-30 22:32:06,922 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:32:06.922885", "details": {"status": "unsafe"}}
2025-11-30 22:32:06,922 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 内容安全检查失败: 输入内容不符合医疗咨询要求
2025-11-30 22:32:24,356 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:32:24.356727", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:32:24,357 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:32:24.357726", "data": {"symptom_text": "我头很晕，怎么办", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 98}
2025-11-30 22:32:24,357 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:32:24.357726", "details": {}}
2025-11-30 22:32:24,358 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:32:24.358726", "details": {"status": "unsafe"}}
2025-11-30 22:32:24,358 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 内容安全检查失败: 输入内容不符合医疗咨询要求
2025-11-30 22:36:40,802 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:36:40.802866", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:36:40,803 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:36:40.803866", "details": {"data_dir_exists": true}}
2025-11-30 22:36:40,803 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:36:40,803 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:36:40.803866", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:36:40,815 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:36:40.815066", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:36:40,816 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:36:40.816064", "details": {"data_dir_exists": true}}
2025-11-30 22:36:40,816 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:36:40,816 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:36:40.816064", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:36:40,816 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:36:40.816064", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:36:40,817 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:36:40.817060", "details": {"data_dir_exists": true}}
2025-11-30 22:36:40,817 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:36:40,817 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:36:40.817060", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:36:40,840 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:36:40.840590", "details": {}}
2025-11-30 22:36:40,840 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:36:40.840590", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:36:40,852 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:36:40.852120", "details": {}}
2025-11-30 22:36:40,852 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:36:40.852120", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:36:40,854 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:36:40.854114", "details": {}}
2025-11-30 22:36:40,854 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:36:40.854114", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:36:41,325 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:36:41.324102", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:36:41,325 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:36:41.325098", "details": {}}
2025-11-30 22:36:41,326 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:36:41.326106", "details": {"instructions_length": 1264}}
2025-11-30 22:36:41,326 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:36:41.326106", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:36:41,327 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:36:41,334 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:36:41.334611", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:36:41,334 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:36:41.334611", "details": {}}
2025-11-30 22:36:41,336 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:36:41.336612", "details": {"instructions_length": 1264}}
2025-11-30 22:36:41,336 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:36:41.336612", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:36:41,337 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:36:41.337613", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:36:41,337 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:36:41.337613", "details": {}}
2025-11-30 22:36:41,338 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:36:41,340 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:36:41.340612", "details": {"instructions_length": 1264}}
2025-11-30 22:36:41,340 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:36:41.340612", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:36:41,341 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:36:41,600 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:36:41.600777", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:36:41,600 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:36:41.600777", "details": {"data_dir_exists": true}}
2025-11-30 22:36:41,601 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:36:41,601 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:36:41.601789", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 200}}
2025-11-30 22:36:41,630 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:36:41.630744", "details": {}}
2025-11-30 22:36:41,631 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:36:41.631757", "details": {"model": "deepseek-chat", "has_api_key": true, "has_base_url": true}}
2025-11-30 22:36:42,090 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "completed", "timestamp": "2025-11-30T22:36:42.090742", "details": {"fixing_parser_enabled": true}}
2025-11-30 22:36:42,090 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:36:42.090742", "details": {}}
2025-11-30 22:36:42,091 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:36:42.091754", "details": {"instructions_length": 1264}}
2025-11-30 22:36:42,091 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:36:42.091754", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:36:42,091 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:40:16,017 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "started", "timestamp": "2025-11-30T22:40:16.017598", "details": {"data_dir": "./data", "absolute_path": "D:\\code\\llm_pra\\day_07\\data"}}
2025-11-30 22:40:16,018 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "file_storage_init", "status": "completed", "timestamp": "2025-11-30T22:40:16.018604", "details": {"data_dir_exists": true}}
2025-11-30 22:40:16,018 - medical_system - INFO - [enhanced_logger.py:213 - info] - Initializing LLM service with model: deepseek-chat
2025-11-30 22:40:16,019 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "started", "timestamp": "2025-11-30T22:40:16.019605", "details": {"model": "deepseek-chat", "temperature": 0.7, "max_tokens": 250}}
2025-11-30 22:40:16,019 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - Running in test mode - no API key provided, will use mock responses
2025-11-30 22:40:16,019 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "test_mode_enabled", "timestamp": "2025-11-30T22:40:16.019605", "details": {"reason": "no_api_key"}}
2025-11-30 22:40:16,019 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "started", "timestamp": "2025-11-30T22:40:16.019605", "details": {}}
2025-11-30 22:40:16,019 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_config", "status": "loading", "timestamp": "2025-11-30T22:40:16.019605", "details": {"model": "deepseek-chat", "has_api_key": false, "has_base_url": false}}
2025-11-30 22:40:16,020 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - API密钥未配置，将使用基础解析器
2025-11-30 22:40:16,020 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "output_parser_init", "status": "completed", "timestamp": "2025-11-30T22:40:16.020604", "details": {}}
2025-11-30 22:40:16,021 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:40:16.021646", "details": {"instructions_length": 1264}}
2025-11-30 22:40:16,021 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_service_init", "status": "completed", "timestamp": "2025-11-30T22:40:16.021646", "details": {"model": "deepseek-chat", "status": "initialized"}}
2025-11-30 22:40:16,021 - medical_system - INFO - [enhanced_logger.py:213 - info] - EnhancedMedicalController initialized successfully
2025-11-30 22:40:16,022 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:40:16.022645", "details": {"symptom_text_length": 7, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:40:16,022 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:40:16.022645", "data": {"symptom_text": "我有点头晕咳嗽", "patient_info": {"age": 25, "gender": "男", "special_conditions": ""}}, "data_size": 97}
2025-11-30 22:40:16,022 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:40:16.022645", "details": {}}
2025-11-30 22:40:16,023 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:40:16.023645", "details": {"status": "safe"}}
2025-11-30 22:40:16,023 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:40:16.023645", "details": {}}
2025-11-30 22:40:16,024 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:40:16.024648", "details": {"symptom_text": "我有点头晕咳嗽"}}
2025-11-30 22:40:16,024 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:40:16.024648", "details": {"extracted_keywords": ["头晕", "咳嗽"], "keyword_count": 2}}
2025-11-30 22:40:16,024 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:40:16.024648", "details": {"matched_diseases": ["D04", "D01"], "total_matches": 2}}
2025-11-30 22:40:16,024 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:40:16.024648", "details": {"best_disease": "D04", "confidence": 0.9, "matched_symptoms": ["头晕"]}}
2025-11-30 22:40:16,024 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:40:16.024648", "details": {"matched_disease": "高血压急症风险", "confidence": 0.9}}
2025-11-30 22:40:16,024 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:40:16.024648", "details": {"disease_id": "D04"}}
2025-11-30 22:40:16,025 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:40:16.025645", "details": {"disease_id": "D04", "data_type": "guideline"}}
2025-11-30 22:40:16,025 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:40:16.025645", "details": {}}
2025-11-30 22:40:16,025 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:40:16.025645", "details": {"filename": "guideline.json"}}
2025-11-30 22:40:16,025 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:40:16.025645", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:40:16,027 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:40:16.027646", "details": {"disease_id": "D04", "data_type": "risk"}}
2025-11-30 22:40:16,027 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:40:16.027646", "details": {}}
2025-11-30 22:40:16,027 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:40:16.027646", "details": {"filename": "disease_info.json"}}
2025-11-30 22:40:16,027 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:40:16.027646", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:40:16,029 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:40:16.029645", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:40:16,029 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:40:16.029645", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:40:16,029 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:40:16.029645", "details": {"data_count": 5}}
2025-11-30 22:40:16,029 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:40:16.029645", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:40:16,029 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:40:16.029645", "details": {"disease_id": "D04", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:40:16,029 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:40:16.029645", "details": {"data_count": 5}}
2025-11-30 22:40:16,030 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:40:16.030645", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:40:16,030 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:40:16.030645", "details": {"disease_id": "D04", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:40:16,030 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:40:16.030645", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:40:16,031 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:40:16.031150", "details": {}}
2025-11-30 22:40:16,031 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:40:16.031150", "details": {"matched_disease": "高血压急症风险", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:40:16,031 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:40:16.031150", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:40:16,032 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:40:16.032158", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:40:16,032 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.032158", "details": {}}
2025-11-30 22:40:16,032 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.032158", "details": {"has_patient_info": true, "disease_name": "高血压急症风险", "matched_symptoms_count": 1}}
2025-11-30 22:40:16,032 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:40:16.032158", "details": {}}
2025-11-30 22:40:16,032 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:40:16.032158", "details": {"instructions_length": 1264}}
2025-11-30 22:40:16,033 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:40:16.033163", "details": {"prompt_length": 1512, "has_format_instructions": true}}
2025-11-30 22:40:16,033 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:40:16.033163", "prompt_length": 1512, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:40:16,033 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:40:16.033163", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:40:16,033 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:40:16.033163", "details": {"disease_name": "高血压急症风险", "urgency": "高"}}
2025-11-30 22:40:16,033 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:40:16.033163", "details": {"response_length": 325, "has_json_format": true}}
2025-11-30 22:40:16,034 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.000 seconds
2025-11-30 22:40:16,034 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:40:16.034164", "details": {"response_length": 325, "duration": 0.0, "model": "deepseek-chat"}}
2025-11-30 22:40:16,034 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:40:16.034164", "prompt_length": 1512, "response_length": 325, "tokens_used": null, "duration_seconds": 0.0, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似高血压急症风险\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"**情况紧急**。建议立即由他人陪同前往最近的急诊中心。\",\n               ..."}
2025-11-30 22:40:16,034 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:40:16.034164", "details": {}}
2025-11-30 22:40:16,034 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.034164", "details": {"output_length": 325, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似高血压急症风险\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"**情况紧急**。建议立即由他人陪同前往最近的急诊中心。\",\n               ..."}}
2025-11-30 22:40:16,035 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:40:16.035162", "details": {}}
2025-11-30 22:40:16,035 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:40:16.035162", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:40:16,035 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:40:16.035162", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:40:16,036 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.002 seconds
2025-11-30 22:40:16,036 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:40:16.036163", "details": {"parsing_time": 0.0019986629486083984, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:40:16,036 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似高血压急症风险...
2025-11-30 22:40:16,036 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:40:16.036163", "metrics": {"total_time": 0.0019986629486083984, "llm_time": 0.0, "parsing_time": 0.0019986629486083984, "output_length": 325, "model": "deepseek-chat"}}
2025-11-30 22:40:16,036 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:40:16.036163", "details": {"advice_generated": true, "assessment_length": 16}}
2025-11-30 22:40:16,036 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:40:16.036163", "details": {}}
2025-11-30 22:40:16,037 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:40:16.037162", "details": {"status": "success", "disease_name": "高血压急症风险", "has_advice": true}}
2025-11-30 22:40:16,037 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 高血压急症风险 (置信度: 0.9)
2025-11-30 22:40:16,037 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:40:16.037162", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:40:16,038 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:40:16.038669", "data": {"symptom_text": "我发烧了，头很痛", "patient_info": {"age": 30, "gender": "女", "special_conditions": "孕妇"}}, "data_size": 100}
2025-11-30 22:40:16,038 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:40:16.038669", "details": {}}
2025-11-30 22:40:16,038 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:40:16.038669", "details": {"status": "safe"}}
2025-11-30 22:40:16,038 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:40:16.038669", "details": {}}
2025-11-30 22:40:16,038 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:40:16.038669", "details": {"symptom_text": "我发烧了，头很痛"}}
2025-11-30 22:40:16,039 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:40:16.039674", "details": {"extracted_keywords": ["发烧"], "keyword_count": 1}}
2025-11-30 22:40:16,039 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:40:16.039674", "details": {"matched_diseases": ["D01"], "total_matches": 1}}
2025-11-30 22:40:16,039 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:40:16.039674", "details": {"best_disease": "D01", "confidence": 0.8, "matched_symptoms": ["发烧"]}}
2025-11-30 22:40:16,039 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:40:16.039674", "details": {"matched_disease": "普通感冒", "confidence": 0.8}}
2025-11-30 22:40:16,039 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:40:16.039674", "details": {"disease_id": "D01"}}
2025-11-30 22:40:16,039 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:40:16.039674", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:40:16,040 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:40:16.040673", "details": {}}
2025-11-30 22:40:16,040 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:40:16.040673", "details": {"filename": "guideline.json"}}
2025-11-30 22:40:16,040 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:40:16.040673", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:40:16,040 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:40:16.040673", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:40:16,040 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:40:16.040673", "details": {}}
2025-11-30 22:40:16,041 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:40:16.041842", "details": {"filename": "disease_info.json"}}
2025-11-30 22:40:16,041 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:40:16.041842", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:40:16,042 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:40:16.042842", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:40:16,043 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:40:16.043841", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:40:16,043 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:40:16.043841", "details": {"data_count": 5}}
2025-11-30 22:40:16,043 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:40:16.043841", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:40:16,043 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:40:16.043841", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:40:16,043 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:40:16.043841", "details": {"data_count": 5}}
2025-11-30 22:40:16,044 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:40:16.044841", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:40:16,044 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:40:16.044841", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:40:16,044 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:40:16.044841", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:40:16,044 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:40:16.044841", "details": {}}
2025-11-30 22:40:16,044 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:40:16.044841", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:40:16,045 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:40:16.045842", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:40:16,045 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:40:16.045842", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:40:16,045 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.045842", "details": {}}
2025-11-30 22:40:16,045 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.045842", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:40:16,045 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:40:16.045842", "details": {}}
2025-11-30 22:40:16,046 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:40:16.046841", "details": {"instructions_length": 1264}}
2025-11-30 22:40:16,046 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:40:16.046841", "details": {"prompt_length": 1499, "has_format_instructions": true}}
2025-11-30 22:40:16,046 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:40:16.046841", "prompt_length": 1499, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:40:16,046 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:40:16.046841", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:40:16,046 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:40:16.046841", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:40:16,046 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:40:16.046841", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:40:16,046 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.000 seconds
2025-11-30 22:40:16,047 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:40:16.046841", "details": {"response_length": 323, "duration": 0.0, "model": "deepseek-chat"}}
2025-11-30 22:40:16,047 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:40:16.047841", "prompt_length": 1499, "response_length": 323, "tokens_used": null, "duration_seconds": 0.0, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}
2025-11-30 22:40:16,047 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:40:16.047841", "details": {}}
2025-11-30 22:40:16,047 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.047841", "details": {"output_length": 323, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}}
2025-11-30 22:40:16,047 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:40:16.047841", "details": {}}
2025-11-30 22:40:16,048 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:40:16.048841", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:40:16,048 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:40:16.048841", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:40:16,048 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.001 seconds
2025-11-30 22:40:16,048 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:40:16.048841", "details": {"parsing_time": 0.0010004043579101562, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:40:16,048 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似上呼吸道感染（普通感冒）...
2025-11-30 22:40:16,048 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:40:16.048841", "metrics": {"total_time": 0.0010004043579101562, "llm_time": 0.0, "parsing_time": 0.0010004043579101562, "output_length": 323, "model": "deepseek-chat"}}
2025-11-30 22:40:16,049 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:40:16.048841", "details": {"advice_generated": true, "assessment_length": 21}}
2025-11-30 22:40:16,049 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:40:16.049841", "details": {}}
2025-11-30 22:40:16,049 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:40:16.049841", "details": {"status": "success", "disease_name": "普通感冒", "has_advice": true}}
2025-11-30 22:40:16,049 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 普通感冒 (置信度: 0.8)
2025-11-30 22:40:16,051 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:40:16.051049", "details": {"symptom_text_length": 9, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:40:16,051 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:40:16.051049", "data": {"symptom_text": "胸口很痛，呼吸困难", "patient_info": {"age": 55, "gender": "男", "special_conditions": "高血压"}}, "data_size": 102}
2025-11-30 22:40:16,052 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:40:16.052055", "details": {}}
2025-11-30 22:40:16,052 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:40:16.052055", "details": {"status": "safe"}}
2025-11-30 22:40:16,052 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:40:16.052055", "details": {}}
2025-11-30 22:40:16,052 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:40:16.052055", "details": {"symptom_text": "胸口很痛，呼吸困难"}}
2025-11-30 22:40:16,052 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:40:16.052055", "details": {"extracted_keywords": [], "keyword_count": 0}}
2025-11-30 22:40:16,052 - medical_system - WARNING - [enhanced_logger.py:217 - warning] - 未提取到任何关键词
2025-11-30 22:40:16,053 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:40:16.053055", "details": {"matched_disease": "普通感冒", "confidence": 0.3}}
2025-11-30 22:40:16,053 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:40:16.053055", "details": {"disease_id": "D01"}}
2025-11-30 22:40:16,053 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:40:16.053055", "details": {"disease_id": "D01", "data_type": "guideline"}}
2025-11-30 22:40:16,053 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:40:16.053055", "details": {}}
2025-11-30 22:40:16,053 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:40:16.053055", "details": {"filename": "guideline.json"}}
2025-11-30 22:40:16,054 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:40:16.054055", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:40:16,054 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:40:16.054055", "details": {"disease_id": "D01", "data_type": "risk"}}
2025-11-30 22:40:16,054 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:40:16.054055", "details": {}}
2025-11-30 22:40:16,055 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:40:16.054055", "details": {"filename": "disease_info.json"}}
2025-11-30 22:40:16,055 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:40:16.055056", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:40:16,056 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:40:16.056056", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:40:16,056 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:40:16.056056", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:40:16,057 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:40:16.057054", "details": {"data_count": 5}}
2025-11-30 22:40:16,057 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:40:16.057054", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:40:16,057 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:40:16.057054", "details": {"disease_id": "D01", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:40:16,057 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:40:16.057054", "details": {"data_count": 5}}
2025-11-30 22:40:16,057 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:40:16.057054", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:40:16,058 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:40:16.058057", "details": {"disease_id": "D01", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:40:16,058 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:40:16.058057", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:40:16,058 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:40:16.058057", "details": {}}
2025-11-30 22:40:16,058 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:40:16.058057", "details": {"matched_disease": "普通感冒", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:40:16,058 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:40:16.058057", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:40:16,059 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:40:16.059056", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:40:16,059 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.059056", "details": {}}
2025-11-30 22:40:16,059 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.059056", "details": {"has_patient_info": true, "disease_name": "普通感冒", "matched_symptoms_count": 1}}
2025-11-30 22:40:16,059 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:40:16.059056", "details": {}}
2025-11-30 22:40:16,059 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:40:16.059056", "details": {"instructions_length": 1264}}
2025-11-30 22:40:16,059 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:40:16.059056", "details": {"prompt_length": 1502, "has_format_instructions": true}}
2025-11-30 22:40:16,059 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:40:16.059056", "prompt_length": 1502, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:40:16,059 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:40:16.059056", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:40:16,060 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:40:16.059056", "details": {"disease_name": "普通感冒", "urgency": "低"}}
2025-11-30 22:40:16,060 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:40:16.060560", "details": {"response_length": 323, "has_json_format": true}}
2025-11-30 22:40:16,060 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.002 seconds
2025-11-30 22:40:16,060 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:40:16.060560", "details": {"response_length": 323, "duration": 0.0015039443969726562, "model": "deepseek-chat"}}
2025-11-30 22:40:16,060 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:40:16.060560", "prompt_length": 1502, "response_length": 323, "tokens_used": null, "duration_seconds": 0.0015039443969726562, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}
2025-11-30 22:40:16,060 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:40:16.060560", "details": {}}
2025-11-30 22:40:16,061 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.061565", "details": {"output_length": 323, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似上呼吸道感染（普通感冒）\",\n                \"immediate_actions\": [\"多休息\", \"多喝水\", \"监测体温\"],\n                \"medical_advice\": \"建议居家观察1-2天，如症状加重或持续发热请及时就医\",\n                \"m..."}}
2025-11-30 22:40:16,061 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:40:16.061565", "details": {}}
2025-11-30 22:40:16,061 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:40:16.061565", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:40:16,061 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:40:16.061565", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:40:16,061 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.000 seconds
2025-11-30 22:40:16,061 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:40:16.061565", "details": {"parsing_time": 0.0, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:40:16,062 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似上呼吸道感染（普通感冒）...
2025-11-30 22:40:16,062 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:40:16.062566", "metrics": {"total_time": 0.0015039443969726562, "llm_time": 0.0015039443969726562, "parsing_time": 0.0, "output_length": 323, "model": "deepseek-chat"}}
2025-11-30 22:40:16,062 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:40:16.062566", "details": {"advice_generated": true, "assessment_length": 21}}
2025-11-30 22:40:16,062 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:40:16.062566", "details": {}}
2025-11-30 22:40:16,062 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:40:16.062566", "details": {"status": "success", "disease_name": "普通感冒", "has_advice": true}}
2025-11-30 22:40:16,062 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 普通感冒 (置信度: 0.3)
2025-11-30 22:40:16,063 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "process_query", "status": "started", "timestamp": "2025-11-30T22:40:16.063571", "details": {"symptom_text_length": 8, "patient_info_keys": ["age", "gender", "special_conditions"], "has_patient_info": true}}
2025-11-30 22:40:16,063 - medical_system - INFO - [enhanced_logger.py:213 - info] - USER_INPUT: {"type": "user_input", "source": "medical_query", "timestamp": "2025-11-30T22:40:16.063571", "data": {"symptom_text": "恶心想吐，肚子痛", "patient_info": {"age": 20, "gender": "女", "special_conditions": ""}}, "data_size": 98}
2025-11-30 22:40:16,063 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "started", "timestamp": "2025-11-30T22:40:16.063571", "details": {}}
2025-11-30 22:40:16,064 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "security_check", "status": "completed", "timestamp": "2025-11-30T22:40:16.064571", "details": {"status": "safe"}}
2025-11-30 22:40:16,065 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:40:16.064571", "details": {}}
2025-11-30 22:40:16,065 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "started", "timestamp": "2025-11-30T22:40:16.065571", "details": {"symptom_text": "恶心想吐，肚子痛"}}
2025-11-30 22:40:16,065 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "keyword_extraction", "status": "completed", "timestamp": "2025-11-30T22:40:16.065571", "details": {"extracted_keywords": ["恶心"], "keyword_count": 1}}
2025-11-30 22:40:16,065 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "disease_matching", "status": "completed", "timestamp": "2025-11-30T22:40:16.065571", "details": {"matched_diseases": ["D03"], "total_matches": 1}}
2025-11-30 22:40:16,065 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "best_match_selection", "status": "completed", "timestamp": "2025-11-30T22:40:16.065571", "details": {"best_disease": "D03", "confidence": 0.85, "matched_symptoms": ["恶心"]}}
2025-11-30 22:40:16,065 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "symptom_matching", "status": "completed", "timestamp": "2025-11-30T22:40:16.065571", "details": {"matched_disease": "急性肠胃炎", "confidence": 0.85}}
2025-11-30 22:40:16,065 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "started", "timestamp": "2025-11-30T22:40:16.065571", "details": {"disease_id": "D03"}}
2025-11-30 22:40:16,066 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:40:16.066571", "details": {"disease_id": "D03", "data_type": "guideline"}}
2025-11-30 22:40:16,066 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "started", "timestamp": "2025-11-30T22:40:16.066571", "details": {}}
2025-11-30 22:40:16,066 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:40:16.066571", "details": {"filename": "guideline.json"}}
2025-11-30 22:40:16,066 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:40:16.066571", "details": {"filepath": "./data\\guideline.json", "file_exists": true}}
2025-11-30 22:40:16,067 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "started", "timestamp": "2025-11-30T22:40:16.067571", "details": {"disease_id": "D03", "data_type": "risk"}}
2025-11-30 22:40:16,067 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "started", "timestamp": "2025-11-30T22:40:16.067571", "details": {}}
2025-11-30 22:40:16,067 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "started", "timestamp": "2025-11-30T22:40:16.067571", "details": {"filename": "disease_info.json"}}
2025-11-30 22:40:16,067 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "checking_file", "timestamp": "2025-11-30T22:40:16.067571", "details": {"filepath": "./data\\disease_info.json", "file_exists": true}}
2025-11-30 22:40:16,068 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:40:16.068571", "details": {"filename": "guideline.json", "data_length": 5, "first_item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:40:16,069 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_guideline_data", "status": "completed", "timestamp": "2025-11-30T22:40:16.069572", "details": {"data_count": 5}}
2025-11-30 22:40:16,069 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:40:16.069572", "details": {"data_type": "guideline", "data_count": 5}}
2025-11-30 22:40:16,069 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:40:16.069572", "details": {"disease_id": "D03", "data_type": "guideline", "found": true, "item_keys": ["disease_id", "urgency", "recommended_action"]}}
2025-11-30 22:40:16,069 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "load_json_file", "status": "completed", "timestamp": "2025-11-30T22:40:16.069572", "details": {"filename": "disease_info.json", "data_length": 5, "first_item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:40:16,070 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_risk_data", "status": "completed", "timestamp": "2025-11-30T22:40:16.070572", "details": {"data_count": 5}}
2025-11-30 22:40:16,070 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "data_loaded", "timestamp": "2025-11-30T22:40:16.070572", "details": {"data_type": "risk", "data_count": 5}}
2025-11-30 22:40:16,070 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "find_by_disease_id", "status": "completed", "timestamp": "2025-11-30T22:40:16.070572", "details": {"disease_id": "D03", "data_type": "risk", "found": true, "item_keys": ["disease_id", "special_notes"]}}
2025-11-30 22:40:16,070 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "knowledge_base_query", "status": "completed", "timestamp": "2025-11-30T22:40:16.070572", "details": {"guideline_found": true, "risk_found": true}}
2025-11-30 22:40:16,071 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "started", "timestamp": "2025-11-30T22:40:16.071076", "details": {}}
2025-11-30 22:40:16,071 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "started", "timestamp": "2025-11-30T22:40:16.071076", "details": {"matched_disease": "急性肠胃炎", "has_guideline": true, "has_risk": true, "has_patient_info": true}}
2025-11-30 22:40:16,071 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "_build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:40:16.071076", "details": {"request_type": "MedicalAdviceRequest", "has_patient_info": true}}
2025-11-30 22:40:16,072 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_advice_request", "status": "completed", "timestamp": "2025-11-30T22:40:16.072081", "details": {"request_type": "MedicalAdviceRequest"}}
2025-11-30 22:40:16,072 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.072081", "details": {}}
2025-11-30 22:40:16,072 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_structured_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.072081", "details": {"has_patient_info": true, "disease_name": "急性肠胃炎", "matched_symptoms_count": 1}}
2025-11-30 22:40:16,072 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "started", "timestamp": "2025-11-30T22:40:16.072081", "details": {}}
2025-11-30 22:40:16,073 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "get_format_instructions", "status": "completed", "timestamp": "2025-11-30T22:40:16.073085", "details": {"instructions_length": 1264}}
2025-11-30 22:40:16,073 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_prompt", "status": "completed", "timestamp": "2025-11-30T22:40:16.073085", "details": {"prompt_length": 1514, "has_format_instructions": true}}
2025-11-30 22:40:16,073 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:40:16.073085", "prompt_length": 1514, "response_length": 0, "tokens_used": null, "duration_seconds": null, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": ""}
2025-11-30 22:40:16,073 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "test_mode_mock", "timestamp": "2025-11-30T22:40:16.073085", "details": {"model": "deepseek-chat", "note": "Using mock response for testing"}}
2025-11-30 22:40:16,073 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "started", "timestamp": "2025-11-30T22:40:16.073085", "details": {"disease_name": "急性肠胃炎", "urgency": "中"}}
2025-11-30 22:40:16,073 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "mock_response_generation", "status": "completed", "timestamp": "2025-11-30T22:40:16.073085", "details": {"response_length": 324, "has_json_format": true}}
2025-11-30 22:40:16,074 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer llm_call completed in 0.001 seconds
2025-11-30 22:40:16,074 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "llm_call", "status": "completed", "timestamp": "2025-11-30T22:40:16.074086", "details": {"response_length": 324, "duration": 0.0010008811950683594, "model": "deepseek-chat"}}
2025-11-30 22:40:16,074 - medical_system - INFO - [enhanced_logger.py:213 - info] - LLM_CALL: {"type": "llm_call", "model": "deepseek-chat", "timestamp": "2025-11-30T22:40:16.074086", "prompt_length": 1514, "response_length": 324, "tokens_used": null, "duration_seconds": 0.0010008811950683594, "prompt_preview": "你是一个专业的医疗导诊AI助手。请根据提供的医疗信息生成准确、安全的建议。\n\n## 格式要求\nThe output should be formatted as a JSON instance that conforms to the JSON schema below.\n\nAs an example, for the schema {\"properties\": {\"foo\": {\"title\":...", "response_preview": "{\n                \"assessment\": \"根据症状分析，疑似急性肠胃炎\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"建议清淡饮食，补充电解质水。若症状频繁或加重，请立即就医。\",\n                ..."}
2025-11-30 22:40:16,074 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "started", "timestamp": "2025-11-30T22:40:16.074086", "details": {}}
2025-11-30 22:40:16,074 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "started", "timestamp": "2025-11-30T22:40:16.074086", "details": {"output_length": 324, "output_preview": "{\n                \"assessment\": \"根据症状分析，疑似急性肠胃炎\",\n                \"immediate_actions\": [\"保持冷静\", \"观察症状变化\", \"记录症状发展\"],\n                \"medical_advice\": \"建议清淡饮食，补充电解质水。若症状频繁或加重，请立即就医。\",\n                ..."}}
2025-11-30 22:40:16,074 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "started", "timestamp": "2025-11-30T22:40:16.074086", "details": {}}
2025-11-30 22:40:16,075 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "base_parser_attempt", "status": "completed", "timestamp": "2025-11-30T22:40:16.075086", "details": {"parse_success": true, "result_type": "MedicalAdviceResponse"}}
2025-11-30 22:40:16,075 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_advice", "status": "completed", "timestamp": "2025-11-30T22:40:16.075086", "details": {"parse_method": "base_parser", "success": true}}
2025-11-30 22:40:16,075 - medical_system - INFO - [enhanced_logger.py:213 - info] - Timer output_parsing completed in 0.001 seconds
2025-11-30 22:40:16,075 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "parse_output", "status": "completed", "timestamp": "2025-11-30T22:40:16.075086", "details": {"parsing_time": 0.0009996891021728516, "advice_valid": true, "advice_type": "MedicalAdviceResponse"}}
2025-11-30 22:40:16,075 - medical_system - INFO - [enhanced_logger.py:213 - info] - Generated advice: 根据症状分析，疑似急性肠胃炎...
2025-11-30 22:40:16,075 - medical_system - INFO - [enhanced_logger.py:213 - info] - PERFORMANCE: {"type": "performance_metrics", "operation": "advice_generation", "timestamp": "2025-11-30T22:40:16.075086", "metrics": {"total_time": 0.002000570297241211, "llm_time": 0.0010008811950683594, "parsing_time": 0.0009996891021728516, "output_length": 324, "model": "deepseek-chat"}}
2025-11-30 22:40:16,075 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "generate_advice", "status": "completed", "timestamp": "2025-11-30T22:40:16.075086", "details": {"advice_generated": true, "assessment_length": 14}}
2025-11-30 22:40:16,076 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "started", "timestamp": "2025-11-30T22:40:16.076086", "details": {}}
2025-11-30 22:40:16,076 - medical_system - INFO - [enhanced_logger.py:213 - info] - PROCESS_STEP: {"type": "process_step", "step_name": "build_result", "status": "completed", "timestamp": "2025-11-30T22:40:16.076086", "details": {"status": "success", "disease_name": "急性肠胃炎", "has_advice": true}}
2025-11-30 22:40:16,076 - medical_system - INFO - [enhanced_logger.py:213 - info] - 查询处理成功: 急性肠胃炎 (置信度: 0.85)
